System.register(["./deprecated-fd5a8e75.js","./deprecated-9a4df5e2.js","./SubContextView-ee466772.js","./component-event-handler-ff37202d.js"],(function(t){"use strict";var e,i,r,n,a,s,o,u,h,l,c,p,f,d,_,m,g,v,y,b,w,k,S,T,x,A,I,E,C,P,M,N,O,R,D,z,B,F,L,j,V,W,U,H,G,q,K,X,Y,J,Q,Z,$,tt,et,it,rt,nt,at,st,ot,ut,ht,lt,ct,pt,ft,dt,_t,mt,gt,vt,yt,bt,wt,kt,St,Tt,xt,At,It,Et,Ct,Pt,Mt,Nt,Ot,Rt,Dt,zt,Bt,Ft,Lt,jt,Vt,Wt,Ut,Ht,Gt,qt,Kt,Xt,Yt,Jt,Qt,Zt,$t,te,ee,ie,re,ne,ae,se,oe,ue,he,le,ce,pe,fe,de,_e,me,ge,ve,ye,be,we,ke,Se,Te,xe,Ae,Ie,Ee,Ce,Pe,Me,Ne,Oe,Re,De,ze,Be,Fe,Le,je,Ve,We,Ue,He,Ge,qe,Ke,Xe,Ye,Je,Qe,Ze,$e,ti,ei,ii,ri,ni,ai,si,oi,ui,hi,li,ci,pi,fi,di,_i,mi,gi,vi,yi,bi,wi,ki,Si,Ti,xi;return{setters:[function(t){e=t.G,i=t.H,r=t.I,n=t.V,a=t.J,s=t.K,o=t.L,u=t.Q,h=t.N,l=t.O,c=t.M,p=t.R,f=t.S,d=t.T,_=t.U,m=t.W,g=t.X,v=t.Y,y=t.Z,b=t.$,w=t.a0,k=t.a1,S=t.k,T=t.a2,x=t.a3,A=t.a4,I=t.a5,E=t.a6,C=t.a7,P=t.a8,M=t.a9,N=t.aa,O=t.ab,R=t.ac,D=t.ad,z=t.ae,B=t.af,F=t.ag,L=t.ah,j=t.j,V=t.d,W=t.b,U=t.e,H=t.f,G=t.l,q=t.aO,K=t.c,X=t.t,Y=t.b2,J=t._,Q=t.h,Z=t.m,$=t.a,tt=t.g,et=t.i,it=t.F,rt=t.ax,nt=t.s,at=t.b6,st=t.bE,ot=t.bF,ut=t.aj,ht=t.b3,lt=t.C,ct=t.bx,pt=t.r,ft=t.bG,dt=t.ap,_t=t.ao,mt=t.n,gt=t.bb,vt=t.w,yt=t.D,bt=t.y,wt=t.aZ,kt=t.ak,St=t.aC,Tt=t.p,xt=t.aR,At=t.a_,It=t.E,Et=t.bH,Ct=t.aA,Pt=t.bl,Mt=t.bI,Nt=t.x,Ot=t.bA},function(t){Rt=t.du,Dt=t.dv,zt=t.dw,Bt=t.dx,Ft=t.dy,Lt=t.dz,jt=t.dA,Vt=t.dB,Wt=t.dC,Ut=t.dD,Ht=t.dE,Gt=t.dF,qt=t.dG,Kt=t.dH,Xt=t.U,Yt=t.h,Jt=t.i,Qt=t.dI,Zt=t.dJ,$t=t.dK,te=t.an,ee=t.l,ie=t.dL,re=t.r,ne=t.c_,ae=t.dM,se=t.aA,oe=t.dN,ue=t.dO,he=t.dP,le=t.Q,ce=t.P,pe=t.T,fe=t.b5,de=t.cX,_e=t.de,me=t.S,ge=t.as,ve=t.G,ye=t.f,be=t.c7,we=t.at,ke=t.b3,Se=t.dQ,Te=t.d7,xe=t.c3,Ae=t.aY,Ie=t.dR,Ee=t.dg,Ce=t.bw,Pe=t.D,Me=t.B,Ne=t.E,Oe=t.H,Re=t.F,De=t.I,ze=t.b_,Be=t.cZ,Fe=t.b6,Le=t.dS,je=t.dT,Ve=t.N,We=t.a1,Ue=t.ai,He=t.a5,Ge=t.af,qe=t.d3,Ke=t.df,Xe=t.dU,Ye=t.dV,Je=t.ay,Qe=t.d5,Ze=t.aP,$e=t.aI,ti=t.av,ei=t.az,ii=t.dW,ri=t.dX,ni=t.ax,ai=t.o,si=t.q,oi=t.p,ui=t.bJ,hi=t.bK,li=t.dY,ci=t.dn,pi=t.dm,fi=t.dp,di=t.dq,_i=t.dZ,mi=t.bP,gi=t.bI,vi=t.bc,yi=t.bp,bi=t.a2},function(t){wi=t.v},function(t){ki=t.d,Si=t.D,Ti=t.S,xi=t.a}],execute:function(){t({F:To,G:xo,r:lh,s:ch,t:ph,x:fo,y:wo});var Ai=Object.freeze({__proto__:null,bits:e,Vec2:i,v2:r,Vec3:n,v3:a,Vec4:s,v4:o,Quat:u,quat:h,Mat3:l,Mat4:c,mat4:p,AffineTransform:f,Size:d,size:_,Rect:m,rect:g,Color:v,color:y,EPSILON:b,equals:w,approx:k,clamp:S,clamp01:T,lerp:x,toRadian:A,toDegree:I,random:E,randomRange:C,randomRangeInt:P,pseudoRandom:M,pseudoRandomRange:N,pseudoRandomRangeInt:O,nextPow2:R,repeat:D,pingPong:z,inverseLerp:B,absMaxComponent:F,absMax:L});t("m",Ai);var Ii=t("Q",function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;V(this,t),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=Rt.SHAPE_CAPSULE,this.radius=e,this.halfHeight=i,this.axis=r,this.center=new n,this.rotation=new u,this.ellipseCenter0=new n(0,i,0),this.ellipseCenter1=new n(0,-i,0),this.updateCache()}return j(t,[{key:"type",get:function(){return this._type}}]),j(t,[{key:"transform",value:function(t,e,i,r,a){var s=r,o=F(s);a.radius=this.radius*Math.abs(o);var h=(this.halfHeight+this.radius)*Math.abs(s.y)-a.radius;h<0&&(h=0),a.halfHeight=h,n.transformMat4(a.center,this.center,t),u.multiply(a.rotation,this.rotation,i),a.updateCache()}},{key:"updateCache",value:function(){this.updateLocalCenter(),n.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),n.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)}},{key:"updateLocalCenter",value:function(){var t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}}}]),t}()),Ei=Object.freeze({__proto__:null,distance:Dt,enums:Rt,intersect:zt,line:Bt,plane:Ft,ray:Lt,triangle:jt,sphere:Vt,aabb:Wt,obb:Ut,capsule:Ii,frustum:Ht,Keyframe:Gt,AnimationCurve:qt,get ERaycastMode(){return Kt}});t("g",Ei);var Ci=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_BAKED_ANIMATION",value:!0}],Pi=t("B",function(t){function e(){var t;V(this,e),(t=U(this,H(e).call(this))).uploadedAnim=void 0,t._jointsMedium=void 0,t._skeleton=null,t._mesh=null,t._dataPoolManager=void 0,t._instAnimInfoIdx=-1,t.type=Xt.BAKED_SKINNING,t._dataPoolManager=G.director.root.dataPoolManager;var i=new Float32Array(4),r=t._dataPoolManager.jointAnimationInfo.getData();return t._jointsMedium={buffer:null,jointTextureInfo:i,animInfo:r,texture:null,boundsInfo:null},t}return W(e,t),j(e,[{key:"destroy",value:function(){this.uploadedAnim=void 0,this._jointsMedium.boundsInfo=null,this._jointsMedium.buffer&&(this._jointsMedium.buffer.destroy(),this._jointsMedium.buffer=null),this._applyJointTexture(),q(H(e.prototype),"destroy",this).call(this)}},{key:"bindSkeleton",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._skeleton=t,this._mesh=i,t&&e&&i){this.transform=e;var r=this._dataPoolManager;this._jointsMedium.animInfo=r.jointAnimationInfo.getData(e.uuid),this._jointsMedium.buffer||(this._jointsMedium.buffer=this._device.createBuffer({usage:Yt.UNIFORM|Yt.TRANSFER_DST,memUsage:Jt.HOST|Jt.DEVICE,size:Qt.SIZE,stride:Qt.SIZE}))}}},{key:"updateTransform",value:function(t){if(q(H(e.prototype),"updateTransform",this).call(this,t),this.uploadedAnim){var i=this._jointsMedium,r=i.animInfo,n=i.boundsInfo[r.data[0]],a=this.transform;this._worldBounds&&n&&n.transform(a._mat,a._pos,a._rot,a._scale,this._worldBounds)}}},{key:"updateUBOs",value:function(t){q(H(e.prototype),"updateUBOs",this).call(this,t);var i=this._jointsMedium.animInfo,r=this._instAnimInfoIdx;r>=0?this.instancedAttributes.list[r].view[0]=i.data[0]:i.dirty&&(i.buffer.update(i.data),i.dirty=!1);return!0}},{key:"createBoundingShape",value:function(t,e){t&&e&&(this._worldBounds=new Wt)}},{key:"uploadAnimation",value:function(t){if(this._skeleton&&this._mesh&&this.uploadedAnim!==t){this.uploadedAnim=t;var e=this._dataPoolManager,i=null;t?(i=e.jointTexturePool.getSequencePoseTexture(this._skeleton,t,this._mesh,this.transform),this._jointsMedium.boundsInfo=i&&i.bounds.get(this._mesh.hash),this._modelBounds=null):(i=e.jointTexturePool.getDefaultPoseTexture(this._skeleton,this._mesh,this.transform),this._jointsMedium.boundsInfo=null,this._modelBounds=i&&i.bounds.get(this._mesh.hash)[0]),this._applyJointTexture(i)}}},{key:"_applyJointTexture",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this._jointsMedium.texture;if(e&&e!==t&&this._dataPoolManager.jointTexturePool.releaseHandle(e),this._jointsMedium.texture=t,t){var i=this._jointsMedium,r=i.buffer,n=i.jointTextureInfo;n[0]=t.handle.texture.width,n[1]=this._skeleton.joints.length,n[2]=t.pixelOffset+.1,n[3]=1/n[0],this.updateInstancedJointTextureInfo(),r&&r.update(n);for(var a=t.handle.texture,s=0;s<this._subModels.length;++s){var o=this._subModels[s].descriptorSet;o.bindTexture(Zt.binding,a)}}}},{key:"getMacroPatches",value:function(t){var i=q(H(e.prototype),"getMacroPatches",this).call(this,t);return i?i.concat(Ci):Ci}},{key:"_updateLocalDescriptors",value:function(t,i){q(H(e.prototype),"_updateLocalDescriptors",this).call(this,t,i);var r=this._jointsMedium,n=r.buffer,a=r.texture,s=r.animInfo;if(i.bindBuffer(Qt.BLOCK.binding,n),i.bindBuffer($t.BLOCK.binding,s.buffer),a){var o=te.getSampler(this._device,ee);i.bindTexture(Zt.binding,a.handle.texture),i.bindSampler(Zt.binding,o)}}},{key:"_updateInstancedAttributes",value:function(t,i){q(H(e.prototype),"_updateInstancedAttributes",this).call(this,t,i),this._instAnimInfoIdx=this._getInstancedAttributeIndex(ie),this.updateInstancedJointTextureInfo()}},{key:"updateInstancedJointTextureInfo",value:function(){var t=this._jointsMedium,e=t.jointTextureInfo,i=t.animInfo,r=this._instAnimInfoIdx;if(r>=0){var n=this.instancedAttributes.list[r].view;n[0]=i.data[0],n[1]=e[1],n[2]=e[2]}}}]),e}(re));var Mi=Object.freeze({__proto__:null,find:ne,toPPM:function(t,e,i){return"P3 ".concat(e," ").concat(i," 255\n").concat(t.filter((function(t,e){return e%4<3})).toString(),"\n")},readMesh:ae,createMesh:se,readBuffer:oe,writeBuffer:ue,mapBuffer:he});t("u",Mi);var Ni,Oi,Ri,Di,zi,Bi,Fi,Li,ji,Vi,Wi,Ui,Hi,Gi,qi,Ki,Xi,Yi,Ji,Qi,Zi,$i,tr,er,ir,rr,nr,ar,sr,or,ur,hr,lr,cr,pr,fr,dr,_r,mr,gr,vr,yr,br,wr,kr,Sr,Tr,xr,Ar,Ir,Er,Cr,Pr,Mr,Nr,Or,Rr,Dr,zr,Br,Fr,Lr,jr,Vr,Wr,Ur,Hr,Gr,qr,Kr,Xr,Yr,Jr,Qr,Zr,$r,tn,en,rn,nn,an,sn,on,un,hn,ln,cn,pn,fn,dn,_n,mn,gn,vn,yn,bn,wn,kn,Sn,Tn,xn,An,In,En,Cn,Pn,Mn,Nn,On,Rn,Dn,zn,Bn,Fn,Ln,jn,Vn,Wn,Un,Hn,Gn,qn,Kn,Xn,Yn,Jn,Qn,Zn,$n=t("S",function(t){function e(){var t;return V(this,e),(t=U(this,H(e).call(this)))._needUpdate=!1,t._size=.15,t._range=1,t._luminance=1700/le(t._size),t._pos=void 0,t._aabb=void 0,t._type=ce.SPHERE,t._aabb=Wt.create(),t._pos=new n,t}return W(e,t),j(e,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(t){this._size=t},get:function(){return this._size}},{key:"range",set:function(t){this._range=t,this._needUpdate=!0},get:function(){return this._range}},{key:"luminance",set:function(t){this._luminance=t},get:function(){return this._luminance}},{key:"aabb",get:function(){return this._aabb}}]),j(e,[{key:"update",value:function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Wt.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._needUpdate=!1)}}]),e}(pe)),ta=t("h",(Ni=K("cc.SkinnedMeshRenderer"),Oi=Q(),Ri=_e(100),Di=Z(),zi=X(fe),Bi=X(de),Fi=X(fe),Li=X(de),ji=$(),Ni(Vi=Oi(Vi=Ri(Vi=Y(Vi=Di((Ui=J((Wi=function(t){function e(){var t;return V(this,e),t=U(this,H(e).call(this)),tt(t,"_skeleton",Ui,et(t)),tt(t,"_skinningRoot",Hi,et(t)),t._clip=null,t._modelType=Pi,t}return W(e,t),j(e,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this._update())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){t!==this._skinningRoot&&(this._skinningRoot=t,this._updateModelType(),this._update())}},{key:"model",get:function(){return this._model}}]),j(e,[{key:"__preload",value:function(){this._updateModelType()}},{key:"uploadAnimation",value:function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)}},{key:"setUseBakedAnimation",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=t?Pi:me;this._modelType!==e&&(this._modelType=e,this._model&&(G.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this.enabledInHierarchy&&this._attachToScene()))}},{key:"setMaterial",value:function(t,i){q(H(e.prototype),"setMaterial",this).call(this,t,i),this._modelType===me&&this.getMaterialInstance(i)}},{key:"_updateModelParams",value:function(){this._update(),q(H(e.prototype),"_updateModelParams",this).call(this)}},{key:"_updateModelType",value:function(){if(this._skinningRoot){var t=this._skinningRoot.getComponent("cc.SkeletalAnimation");t&&this.setUseBakedAnimation(t.useBakedAnimation)}}},{key:"_update",value:function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))}}]),e}(ge)).prototype,"_skeleton",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hi=J(Wi.prototype,"_skinningRoot",[Bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J(Wi.prototype,"skeleton",[Fi],Object.getOwnPropertyDescriptor(Wi.prototype,"skeleton"),Wi.prototype),J(Wi.prototype,"skinningRoot",[Li,ji],Object.getOwnPropertyDescriptor(Wi.prototype,"skinningRoot"),Wi.prototype),Vi=Wi))||Vi)||Vi)||Vi)||Vi)||Vi)),ea={name:ve.ATTR_BATCH_ID,format:ye.R32F,isNormalized:!1},ia={name:ve.ATTR_BATCH_UV,format:ye.RG32F,isNormalized:!1},ra=be[ea.format].size+be[ia.format].size,na=t("j",(Gi=K("cc.SkinnedMeshUnit"),qi=X(we),Ki=X(fe),Xi=X(ke),Yi=X(ta),Gi((Zi=J((Qi=function(){function t(){V(this,t),tt(this,"mesh",Zi,this),tt(this,"skeleton",$i,this),tt(this,"material",tr,this),tt(this,"_localTransform",er,this),tt(this,"_offset",ir,this),tt(this,"_size",rr,this)}return j(t,[{key:"offset",set:function(t){i.copy(this._offset,t)},get:function(){return this._offset}},{key:"size",set:function(t){i.copy(this._size,t)},get:function(){return this._size}},{key:"copyFrom",set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getMaterial(0),t.skinningRoot&&Te(t.node,t.skinningRoot,this._localTransform))},get:function(){return null}}]),t}()).prototype,"mesh",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$i=J(Qi.prototype,"skeleton",[Ki],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tr=J(Qi.prototype,"material",[Xi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),er=J(Qi.prototype,"_localTransform",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new c}}),ir=J(Qi.prototype,"_offset",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i(0,0)}}),rr=J(Qi.prototype,"_size",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i(1,1)}}),J(Qi.prototype,"offset",[it],Object.getOwnPropertyDescriptor(Qi.prototype,"offset"),Qi.prototype),J(Qi.prototype,"size",[it],Object.getOwnPropertyDescriptor(Qi.prototype,"size"),Qi.prototype),J(Qi.prototype,"copyFrom",[Yi],Object.getOwnPropertyDescriptor(Qi.prototype,"copyFrom"),Qi.prototype),Ji=Qi))||Ji)),aa=new c,sa=(new c,new n),oa=t("i",(nr=K("cc.SkinnedMeshBatchRenderer"),ar=Q(),sr=_e(100),or=Z(),ur=$(),hr=X([rt]),lr=$(),cr=X([na]),pr=$(),fr=at(),dr=at(),nr(_r=ar(_r=sr(_r=Y(_r=or((gr=J((mr=function(t){function e(){var t,i;V(this,e);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return i=U(this,(t=H(e)).call.apply(t,[this].concat(n))),tt(i,"atlasSize",gr,et(i)),tt(i,"batchableTextureNames",vr,et(i)),tt(i,"units",yr,et(i)),i._textures={},i._batchMaterial=null,i}return W(e,t),j(e,[{key:"onLoad",value:function(){q(H(e.prototype),"onLoad",this).call(this),this.cook()}},{key:"onDestroy",value:function(){for(var t in this._textures)this._textures[t].destroy();this._textures={},this._mesh&&(this._mesh.destroy(),this._mesh=null),q(H(e.prototype),"onDestroy",this).call(this)}},{key:"_onMaterialModified",value:function(t,i){this.cookMaterials(),q(H(e.prototype),"_onMaterialModified",this).call(this,t,this.getMaterialInstance(t))}},{key:"cook",value:function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()}},{key:"cookMaterials",value:function(){var t=this;this._batchMaterial||(this._batchMaterial=this.getMaterial(0));var e=this.getMaterialInstance(0);if(e&&this._batchMaterial&&this._batchMaterial.effectAsset){e.copy(this._batchMaterial),this.resizeAtlases();for(var i=e.effectAsset.techniques[e.technique],r=function(r){var n=i.passes[r];if(!n.properties)return"continue";var a=function(i){if(n.properties[i].type>=Ce.SAMPLER1D){var a=null;t.batchableTextureNames.find((function(t){return t===i}))?((a=t._textures[i])||(a=t.createTexture(i)),t.cookTextures(a,i,r)):t.units.some((function(t){return a=t.material&&t.material.getProperty(i,r)})),a&&e.setProperty(i,a,r)}else{for(var s=[],o=0;o<t.units.length;o++){var u=t.units[o];u.material&&s.push(u.material.getProperty(i.slice(0,-3),r))}e.setProperty(i,s,r)}};for(var s in n.properties)a(s)},n=0;n<i.passes.length;n++)r(n)}else console.warn("incomplete batch material!")}},{key:"cookSkeletons",value:function(){if(this._skinningRoot){for(var t=[],e=[],i=0;i<this.units.length;i++){var r=this.units[i];if(r&&r.skeleton){var n=r.skeleton;c.invert(aa,r._localTransform);for(var a=function(i){var r=n.joints[i];if(t.findIndex((function(t){return t===r}))>=0)return"continue";t.push(r),e.push(c.multiply(new c,n.bindposes[i]||c.IDENTITY,aa))},s=0;s<n.joints.length;s++)a(s)}}var o=Array.from(Array(t.length).keys()).sort((function(e,i){return t[e]>t[i]?1:t[e]<t[i]?-1:0})),u=new fe;u.joints=t.map((function(t,e,i){return i[o[e]]})),u.bindposes=e.map((function(t,e,i){return i[o[e]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=u}else console.warn("no skinning root specified!")}},{key:"cookMeshes",value:function(){for(var t=this,e=!1,i=0;i<this.units.length;i++){if(this.units[i].mesh){e=!0;break}}if(e&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new we;for(var r=0,a=ye.UNKNOWN,s=0,o=ye.UNKNOWN,u=0,h=ye.UNKNOWN,l=0,p=ye.UNKNOWN,f=0,d=ye.UNKNOWN,_=new Array(this.units.length),m=this.units.length,g=0;g<m;g++){var v=this.units[g];v&&v.skeleton&&(_[g]=v.skeleton.joints.map((function(e){return t._skeleton.joints.findIndex((function(t){return e===t}))})))}for(var y=function(e){var i=t.units[e];if(!i||!i.mesh||!i.mesh.data)return"continue";var m=t._createUnitMesh(e,i.mesh),g=new DataView(m.data.buffer);c.inverseTranspose(aa,i._localTransform);for(var v=i.offset,y=i.size,b=function(t){var c=m.struct.vertexBundles[t];r=c.view.offset,a=ye.UNKNOWN;for(var b=0;b<c.attributes.length;b++){var w=c.attributes[b];if(w.name===ve.ATTR_POSITION){a=w.format;break}r+=be[w.format].size}if(a){for(var k=oe(g,a,r,c.view.length,c.view.stride),S=0;S<k.length;S+=3)n.fromArray(sa,k,S),n.transformMat4(sa,sa,i._localTransform),n.toArray(k,sa,S);ue(g,k,a,r,c.view.stride)}s=c.view.offset,o=ye.UNKNOWN;for(var T=0;T<c.attributes.length;T++){var x=c.attributes[T];if(x.name===ve.ATTR_NORMAL){o=x.format;break}s+=be[x.format].size}if(o){for(var A=oe(g,o,s,c.view.length,c.view.stride),I=0;I<A.length;I+=3)n.fromArray(sa,A,I),n.transformMat4Normal(sa,sa,aa),n.toArray(A,sa,I);ue(g,A,o,s,c.view.stride)}u=c.view.offset,h=ye.UNKNOWN;for(var E=0;E<c.attributes.length;E++){var C=c.attributes[E];if(C.name===ve.ATTR_TANGENT){h=C.format;break}u+=be[C.format].size}if(h){for(var P=oe(g,h,u,c.view.length,c.view.stride),M=0;M<P.length;M+=3)n.fromArray(sa,P,M),n.transformMat4Normal(sa,sa,aa),n.toArray(P,sa,M);ue(g,P,h,u,c.view.stride)}l=c.view.offset,p=ye.UNKNOWN;for(var N=0;N<c.attributes.length;N++){var O=c.attributes[N];if(O.name===ve.ATTR_BATCH_UV){p=O.format;break}l+=be[O.format].size}p&&he(g,(function(t,e){var i,r=0===e?"x":"y";return(t=(i=t)-Math.floor(i))*y[r]+v[r]}),p,l,c.view.length,c.view.stride,g);var R=_[e];if(!R)return"continue";f=c.view.offset,d=ye.UNKNOWN;for(var D=0;D<c.attributes.length;D++){var z=c.attributes[D];if(z.name===ve.ATTR_JOINTS){d=z.format;break}f+=be[z.format].size}d&&he(g,(function(t){return R[t]}),d,f,c.view.length,c.view.stride,g)},w=0;w<m.struct.vertexBundles.length;w++)b(w);t._mesh.merge(m)},b=0;b<m;b++)y(b);this._onMeshChanged(this._mesh),this._updateModels()}}},{key:"cookTextures",value:function(t,e,i){for(var r=[],n=[],a=[],s=[],o=0;o<this.units.length;o++){var u=this.units[o];if(u.material){var h=u.material.getProperty(e,i);if(h&&h.image&&h.image.data){var l=new xe;l.texOffset.x=u.offset.x*this.atlasSize,l.texOffset.y=u.offset.y*this.atlasSize,l.texExtent.width=u.size.x*this.atlasSize,l.texExtent.height=u.size.y*this.atlasSize;var c=h.image.data;c instanceof HTMLCanvasElement||c instanceof HTMLImageElement?(r.push(c),n.push(l)):(a.push(c),s.push(l))}}}var p=t.getGFXTexture(),f=G.director.root.device;a.length>0&&f.copyBuffersToTexture(a,p,s),r.length>0&&f.copyTexImagesToTexture(r,p,n)}},{key:"createTexture",value:function(t){var e=new Ae;return e.setFilters(Ie.LINEAR,Ie.LINEAR),e.setMipFilter(Ie.LINEAR),e.reset({width:this.atlasSize,height:this.atlasSize,format:Ee.RGBA8888}),e.loaded=!0,this._textures[t]=e,e}},{key:"resizeAtlases",value:function(){for(var t in this._textures){this._textures[t].reset({width:this.atlasSize,height:this.atlasSize,format:Ee.RGBA8888})}}},{key:"_createUnitMesh",value:function(t,e){for(var i=JSON.parse(JSON.stringify(e.struct)),r={},n=0;n<e.struct.primitives.length;n++){for(var a=e.struct.primitives[n],s=0,o=ye.UNKNOWN,u=0;u<a.vertexBundelIndices.length;u++){var h=e.struct.vertexBundles[a.vertexBundelIndices[u]];s=h.view.offset,o=ye.UNKNOWN;for(var l=0;l<h.attributes.length;l++){var c=h.attributes[l];if(c.name===ve.ATTR_TEX_COORD){o=c.format;break}s+=be[c.format].size}if(o)break}if(void 0===r[u]){r[u]=[o,s];var p=i.vertexBundles[u];p.attributes.push(ea),p.attributes.push(ia),p.view.offset=0,p.view.length+=p.view.count*ra,p.view.stride+=ra}}for(var f=0,d=0;d<i.vertexBundles.length;d++)f+=i.vertexBundles[d].view.length;for(var _=0;_<i.primitives.length;_++){var m=i.primitives[_];m.indexView&&(m.indexView.offset=f,f+=m.indexView.length)}var g=new Uint8Array(f),v=e.data,y=new DataView(g.buffer),b=new DataView(v.buffer),w=G.sys.isLittleEndian;for(var k in r)for(var S=i.vertexBundles[k],T=e.struct.vertexBundles[k],x=st(r[k],2),A=x[0],I=x[1],E=oe(b,A,I,T.view.length,T.view.stride),C=T.view,P=S.view,M=C.stride,N=P.stride,O=C.offset,R=P.offset,D=0;D<P.count;D++){var z=v.subarray(O,O+M);g.set(z,R),y.setFloat32(R+M,t),y.setFloat32(R+M+4,E[2*D],w),y.setFloat32(R+M+8,E[2*D+1],w),R+=N,O+=M}for(var B=0;B<i.primitives.length;B++){var F=e.struct.primitives[B],L=i.primitives[B];if(F.indexView&&L.indexView)for(var j=F.indexView.stride,V=L.indexView.stride,W=F.indexView.offset,U=L.indexView.offset,H=0;H<L.indexView.count;H++){var q=v.subarray(W,W+j);g.set(q,U),U+=V,W+=j}}var K=new we;return K.reset({struct:i,data:g}),K}},{key:"mesh",get:function(){return q(H(e.prototype),"mesh",this)},set:function(t){ot(H(e.prototype),"mesh",t,this,!0)}},{key:"skeleton",get:function(){return q(H(e.prototype),"skeleton",this)},set:function(t){ot(H(e.prototype),"skeleton",t,this,!0)}}]),e}(ta)).prototype,"atlasSize",[nt,ur],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),vr=J(mr.prototype,"batchableTextureNames",[hr,nt,lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yr=J(mr.prototype,"units",[cr,nt,pr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),J(mr.prototype,"mesh",[Se,fr],Object.getOwnPropertyDescriptor(mr.prototype,"mesh"),mr.prototype),J(mr.prototype,"skeleton",[Se,dr],Object.getOwnPropertyDescriptor(mr.prototype,"skeleton"),mr.prototype),_r=mr))||_r)||_r)||_r)||_r)||_r)),ua=new n,ha=ut(Pe),la=ut(Me),ca=ut(Ne),pa=ut(Oe),fa=ut(Re),da=ut({SKYBOX:De|ze.DEPTH_STENCIL,SOLID_COLOR:ze.ALL,DEPTH_ONLY:ze.DEPTH_STENCIL,DONT_CLEAR:ze.NONE}),_a=t("f",(br=K("cc.Camera"),wr=Q(),kr=Z(),Sr=ht(),Tr=$(),xr=X(Be.BitMask),Ar=ht(),Ir=$(),Er=X(da),Cr=ht(),Pr=$(),Mr=ht(),Nr=$(),Or=ht(),Rr=$(),Dr=ht(),zr=$(),Br=X(ha),Fr=ht(),Lr=$(),jr=X(la),Vr=ht(),Wr=$(),Ur=ht(),Hr=$(),Gr=ht(),qr=$(),Kr=ht(),Xr=$(),Yr=ht(),Jr=$(),Qr=X(ca),Zr=ht(),$r=$(),tn=X(pa),en=ht(),rn=$(),nn=X(fa),an=ht(),sn=$(),on=ht(),un=$(),hn=X(Fe),ln=ht(),cn=$(),br(pn=wr(pn=kr(pn=Y((On=Nn=function(t){function e(){var t,i;V(this,e);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return i=U(this,(t=H(e)).call.apply(t,[this].concat(n))),tt(i,"_projection",dn,et(i)),tt(i,"_priority",_n,et(i)),tt(i,"_fov",mn,et(i)),tt(i,"_fovAxis",gn,et(i)),tt(i,"_orthoHeight",vn,et(i)),tt(i,"_near",yn,et(i)),tt(i,"_far",bn,et(i)),tt(i,"_color",wn,et(i)),tt(i,"_depth",kn,et(i)),tt(i,"_stencil",Sn,et(i)),tt(i,"_clearFlags",Tn,et(i)),tt(i,"_rect",xn,et(i)),tt(i,"_aperture",An,et(i)),tt(i,"_shutter",In,et(i)),tt(i,"_iso",En,et(i)),tt(i,"_screenScale",Cn,et(i)),tt(i,"_visibility",Pn,et(i)),tt(i,"_targetTexture",Mn,et(i)),i._camera=null,i._inEditorMode=!1,i._flows=void 0,i}return W(e,t),j(e,[{key:"onLoad",value:function(){this._createCamera()}},{key:"onEnable",value:function(){this.node.hasChangedFlags|=Le.POSITION,this._camera&&this._attachToScene()}},{key:"onDisable",value:function(){this._camera&&this._detachFromScene()}},{key:"onDestroy",value:function(){this._camera&&(G.director.root.destroyCamera(this._camera),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")}},{key:"screenPointToRay",value:function(t,e,i){return i||(i=Lt.create()),this._camera&&this._camera.screenPointToRay(i,t,e),i}},{key:"worldToScreen",value:function(t,e){return e||(e=new n),this._camera&&this._camera.worldToScreen(e,t),e}},{key:"screenToWorld",value:function(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e}},{key:"convertToUINode",value:function(t,e,i){if(i||(i=new n),!this._camera)return i;this.worldToScreen(t,ua);var r=e.getComponent("cc.UITransform"),a=wi.getVisibleSize(),s=ua.x-.5*this._camera.width,o=ua.y-.5*this._camera.height;return ua.x=s/G.view.getScaleX()+.5*a.width,ua.y=o/G.view.getScaleY()+.5*a.height,r&&r.convertToNodeSpaceAR(ua,i),i}},{key:"_createCamera",value:function(){if(this._camera=G.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?G.director.root&&G.director.root.mainWindow:G.director.root&&G.director.root.tempWindow,priority:this._priority,flows:this._flows}),this._camera){this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=A(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far;var t=this._color.x,e=this._color.y,i=this._color.z,r=this._color.w;this._camera.clearColor={r:t,g:e,b:i,a:r},this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso}this._updateTargetTexture()}},{key:"_attachToScene",value:function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))}},{key:"_detachFromScene",value:function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)}},{key:"_chechTargetTextureEvent",value:function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)}},{key:"_updateTargetTexture",value:function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}}},{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor.r=this._color.x,this._camera.clearColor.g=this._color.y,this._camera.clearColor.b=this._color.z,this._camera.clearColor.a=this._color.w)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,t===Me.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=A(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&(this._camera.viewport=t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var e=this._targetTexture;this._targetTexture=t,this._chechTargetTextureEvent(e),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){this._inEditorMode=t,this._camera&&this._camera.changeTargetWindow(t?G.director.root&&G.director.root.mainWindow:G.director.root&&G.director.root.tempWindow)}},{key:"flows",set:function(t){this._camera&&(this._camera.flows=t),this._flows=t}}]),e}(lt),Nn.ProjectionType=ha,Nn.FOVAxis=la,Nn.ClearFlag=da,Nn.Aperture=ca,Nn.Shutter=pa,Nn.ISO=fa,dn=J((fn=On).prototype,"_projection",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ha.PERSPECTIVE}}),_n=J(fn.prototype,"_priority",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mn=J(fn.prototype,"_fov",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),gn=J(fn.prototype,"_fovAxis",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return la.VERTICAL}}),vn=J(fn.prototype,"_orthoHeight",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),yn=J(fn.prototype,"_near",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),bn=J(fn.prototype,"_far",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),wn=J(fn.prototype,"_color",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new v("#333333")}}),kn=J(fn.prototype,"_depth",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Sn=J(fn.prototype,"_stencil",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Tn=J(fn.prototype,"_clearFlags",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return da.SOLID_COLOR}}),xn=J(fn.prototype,"_rect",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m(0,0,1,1)}}),An=J(fn.prototype,"_aperture",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ca.F16_0}}),In=J(fn.prototype,"_shutter",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pa.D125}}),En=J(fn.prototype,"_iso",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fa.ISO100}}),Cn=J(fn.prototype,"_screenScale",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Pn=J(fn.prototype,"_visibility",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return je}}),Mn=J(fn.prototype,"_targetTexture",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J(fn.prototype,"priority",[Sr,Tr],Object.getOwnPropertyDescriptor(fn.prototype,"priority"),fn.prototype),J(fn.prototype,"visibility",[xr,Ar,Ir],Object.getOwnPropertyDescriptor(fn.prototype,"visibility"),fn.prototype),J(fn.prototype,"clearFlags",[Er,Cr,Pr],Object.getOwnPropertyDescriptor(fn.prototype,"clearFlags"),fn.prototype),J(fn.prototype,"clearColor",[Mr,Nr],Object.getOwnPropertyDescriptor(fn.prototype,"clearColor"),fn.prototype),J(fn.prototype,"clearDepth",[Or,Rr],Object.getOwnPropertyDescriptor(fn.prototype,"clearDepth"),fn.prototype),J(fn.prototype,"clearStencil",[Dr,zr],Object.getOwnPropertyDescriptor(fn.prototype,"clearStencil"),fn.prototype),J(fn.prototype,"projection",[Br,Fr,Lr],Object.getOwnPropertyDescriptor(fn.prototype,"projection"),fn.prototype),J(fn.prototype,"fovAxis",[jr,Vr,Wr],Object.getOwnPropertyDescriptor(fn.prototype,"fovAxis"),fn.prototype),J(fn.prototype,"fov",[Ur,Hr],Object.getOwnPropertyDescriptor(fn.prototype,"fov"),fn.prototype),J(fn.prototype,"orthoHeight",[Gr,qr],Object.getOwnPropertyDescriptor(fn.prototype,"orthoHeight"),fn.prototype),J(fn.prototype,"near",[Kr,Xr],Object.getOwnPropertyDescriptor(fn.prototype,"near"),fn.prototype),J(fn.prototype,"far",[Yr,Jr],Object.getOwnPropertyDescriptor(fn.prototype,"far"),fn.prototype),J(fn.prototype,"aperture",[Qr,Zr,$r],Object.getOwnPropertyDescriptor(fn.prototype,"aperture"),fn.prototype),J(fn.prototype,"shutter",[tn,en,rn],Object.getOwnPropertyDescriptor(fn.prototype,"shutter"),fn.prototype),J(fn.prototype,"iso",[nn,an,sn],Object.getOwnPropertyDescriptor(fn.prototype,"iso"),fn.prototype),J(fn.prototype,"rect",[on,un],Object.getOwnPropertyDescriptor(fn.prototype,"rect"),fn.prototype),J(fn.prototype,"targetTexture",[hn,ln,cn],Object.getOwnPropertyDescriptor(fn.prototype,"targetTexture"),fn.prototype),pn=fn))||pn)||pn)||pn)||pn));G.Camera=_a;var ma,ga,va,ya,ba,wa,ka,Sa,Ta,xa,Aa,Ia,Ea,Ca,Pa,Ma,Na,Oa,Ra,Da,za,Ba,Fa,La,ja,Va,Wa,Ua,Ha,Ga,qa,Ka,Xa,Ya,Ja,Qa,Za,$a,ts,es,is,rs,ns,as,ss,os,us,hs,ls,cs,ps=ut({LUMINOUS_POWER:0,LUMINANCE:1}),fs=K("cc.StaticLightSettings")((zn=J((Dn=function(){function t(){V(this,t),tt(this,"_editorOnly",zn,this),tt(this,"_bakeable",Bn,this),tt(this,"_castShadow",Fn,this)}return j(t,[{key:"editorOnly",get:function(){return this._editorOnly},set:function(t){this._editorOnly=t}},{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}}]),t}()).prototype,"_editorOnly",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Bn=J(Dn.prototype,"_bakeable",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Fn=J(Dn.prototype,"_castShadow",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),J(Dn.prototype,"editorOnly",[it],Object.getOwnPropertyDescriptor(Dn.prototype,"editorOnly"),Dn.prototype),J(Dn.prototype,"bakeable",[it],Object.getOwnPropertyDescriptor(Dn.prototype,"bakeable"),Dn.prototype),J(Dn.prototype,"castShadow",[it],Object.getOwnPropertyDescriptor(Dn.prototype,"castShadow"),Dn.prototype),Rn=Dn))||Rn,ds=t("L",(Ln=K("cc.Light"),jn=$(),Vn=$(),Wn=pt(),Un=$(),Hn=X(fs),Ln((Zn=Qn=function(t){function e(){var t;return V(this,e),t=U(this,H(e).call(this)),tt(t,"_color",Kn,et(t)),tt(t,"_useColorTemperature",Xn,et(t)),tt(t,"_colorTemperature",Yn,et(t)),tt(t,"_staticSettings",Jn,et(t)),t._type=ce.UNKNOWN,t._lightType=void 0,t._light=null,t._lightType=pe,t}return W(e,t),j(e,[{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._light&&(this._light.color.x=t.r/255,this._light.color.y=t.g/255,this._light.color.z=t.b/255)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,this._light&&(this._light.useColorTemperature=t)}},{key:"colorTemperature",get:function(){return this._colorTemperature},set:function(t){this._colorTemperature=t,this._light&&(this._light.colorTemperature=t)}},{key:"staticSettings",get:function(){return this._staticSettings},set:function(t){this._staticSettings=t}},{key:"type",get:function(){return this._type}}]),j(e,[{key:"onLoad",value:function(){this._createLight()}},{key:"onEnable",value:function(){this._attachToScene()}},{key:"onDisable",value:function(){this._detachFromScene()}},{key:"onDestroy",value:function(){this._destroyLight()}},{key:"_createLight",value:function(){this._light||(this._light=G.director.root.createLight(this._lightType)),this.color=this._color,this.useColorTemperature=this._useColorTemperature,this.colorTemperature=this._colorTemperature,this._light.node=this.node}},{key:"_destroyLight",value:function(){this._light&&(G.director.root.destroyLight(this),this._light=null)}},{key:"_attachToScene",value:function(){if(this._detachFromScene(),this._light&&!this._light.scene&&this.node.scene){var t=this._getRenderScene();switch(this._type){case ce.DIRECTIONAL:t.addDirectionalLight(this._light),t.setMainLight(this._light);break;case ce.SPHERE:t.addSphereLight(this._light);break;case ce.SPOT:t.addSpotLight(this._light)}}}},{key:"_detachFromScene",value:function(){if(this._light&&this._light.scene){var t=this._light.scene;switch(this._type){case ce.DIRECTIONAL:t.removeDirectionalLight(this._light),t.unsetMainLight(this._light);break;case ce.SPHERE:t.removeSphereLight(this._light);break;case ce.SPOT:t.removeSpotLight(this._light)}}}}]),e}(lt),Qn.Type=ce,Qn.PhotometricTerm=ps,Kn=J((qn=Zn).prototype,"_color",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return v.WHITE.clone()}}),Xn=J(qn.prototype,"_useColorTemperature",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yn=J(qn.prototype,"_colorTemperature",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6550}}),Jn=J(qn.prototype,"_staticSettings",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fs}}),J(qn.prototype,"color",[jn],Object.getOwnPropertyDescriptor(qn.prototype,"color"),qn.prototype),J(qn.prototype,"useColorTemperature",[Vn],Object.getOwnPropertyDescriptor(qn.prototype,"useColorTemperature"),qn.prototype),J(qn.prototype,"colorTemperature",[ct,Wn,Un],Object.getOwnPropertyDescriptor(qn.prototype,"colorTemperature"),qn.prototype),J(qn.prototype,"staticSettings",[Hn],Object.getOwnPropertyDescriptor(qn.prototype,"staticSettings"),qn.prototype),Gn=qn))||Gn)),_s=t("D",(ma=K("cc.DirectionalLight"),ga=Q(),va=Z(),ya=ft(),ba=$(),ma(wa=ga(wa=va(wa=Y((Sa=J((ka=function(t){function e(){var t;return V(this,e),t=U(this,H(e).call(this)),tt(t,"_illuminance",Sa,et(t)),t._type=ce.DIRECTIONAL,t._light=null,t._lightType=Ve,t}return W(e,t),j(e,[{key:"illuminance",get:function(){return this._illuminance},set:function(t){this._illuminance=t,this._light&&(this._light.illuminance=this._illuminance)}}]),j(e,[{key:"_createLight",value:function(){q(H(e.prototype),"_createLight",this).call(this),this._light&&(this.illuminance=this._illuminance)}}]),e}(ds)).prototype,"_illuminance",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 65e3}}),J(ka.prototype,"illuminance",[ya,ba],Object.getOwnPropertyDescriptor(ka.prototype,"illuminance"),ka.prototype),wa=ka))||wa)||wa)||wa)||wa)),ms=t("k",(Ta=K("cc.SphereLight"),xa=Q(),Aa=Z(),Ia=ft(),Ea=$(),Ca=ft(),Pa=$(),Ma=X(ps),Na=$(),Oa=$(),Ra=$(),Ta(Da=xa(Da=Aa(Da=Y((Ba=J((za=function(t){function e(){var t;return V(this,e),t=U(this,H(e).call(this)),tt(t,"_size",Ba,et(t)),tt(t,"_luminance",Fa,et(t)),tt(t,"_term",La,et(t)),tt(t,"_range",ja,et(t)),t._type=ce.SPHERE,t._light=null,t._lightType=$n,t}return W(e,t),j(e,[{key:"luminousPower",get:function(){return this._luminance*le(this._size)},set:function(t){this._luminance=t/le(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),j(e,[{key:"_createLight",value:function(){q(H(e.prototype),"_createLight",this).call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range)}}]),e}(ds)).prototype,"_size",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),Fa=J(za.prototype,"_luminance",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/le(.15)}}),La=J(za.prototype,"_term",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ps.LUMINOUS_POWER}}),ja=J(za.prototype,"_range",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),J(za.prototype,"luminousPower",[Ia,Ea],Object.getOwnPropertyDescriptor(za.prototype,"luminousPower"),za.prototype),J(za.prototype,"luminance",[Ca,Pa],Object.getOwnPropertyDescriptor(za.prototype,"luminance"),za.prototype),J(za.prototype,"term",[Ma,Na],Object.getOwnPropertyDescriptor(za.prototype,"term"),za.prototype),J(za.prototype,"size",[Oa],Object.getOwnPropertyDescriptor(za.prototype,"size"),za.prototype),J(za.prototype,"range",[Ra],Object.getOwnPropertyDescriptor(za.prototype,"range"),za.prototype),Da=za))||Da)||Da)||Da)||Da)),gs=t("l",(Va=K("cc.SpotLight"),Wa=Q(),Ua=Z(),Ha=ft(),Ga=$(),qa=ft(),Ka=$(),Xa=X(ps),Ya=$(),Ja=$(),Qa=$(),Za=pt(),$a=$(),Va(ts=Wa(ts=Ua(ts=Y((is=J((es=function(t){function e(){var t;return V(this,e),t=U(this,H(e).call(this)),tt(t,"_size",is,et(t)),tt(t,"_luminance",rs,et(t)),tt(t,"_term",ns,et(t)),tt(t,"_range",as,et(t)),tt(t,"_spotAngle",ss,et(t)),t._type=ce.SPOT,t._light=null,t._lightType=We,t}return W(e,t),j(e,[{key:"luminousPower",get:function(){return this._luminance*le(this._size)},set:function(t){this._luminance=t/le(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._spotAngle=t,this._light&&(this._light.spotAngle=A(t))}}]),j(e,[{key:"_createLight",value:function(){q(H(e.prototype),"_createLight",this).call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range,this.spotAngle=this._spotAngle)}}]),e}(ds)).prototype,"_size",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),rs=J(es.prototype,"_luminance",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/le(.15)}}),ns=J(es.prototype,"_term",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ps.LUMINOUS_POWER}}),as=J(es.prototype,"_range",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ss=J(es.prototype,"_spotAngle",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),J(es.prototype,"luminousPower",[Ha,Ga],Object.getOwnPropertyDescriptor(es.prototype,"luminousPower"),es.prototype),J(es.prototype,"luminance",[qa,Ka],Object.getOwnPropertyDescriptor(es.prototype,"luminance"),es.prototype),J(es.prototype,"term",[Xa,Ya],Object.getOwnPropertyDescriptor(es.prototype,"term"),es.prototype),J(es.prototype,"size",[Ja],Object.getOwnPropertyDescriptor(es.prototype,"size"),es.prototype),J(es.prototype,"range",[Qa],Object.getOwnPropertyDescriptor(es.prototype,"range"),es.prototype),J(es.prototype,"spotAngle",[ct,Za,$a],Object.getOwnPropertyDescriptor(es.prototype,"spotAngle"),es.prototype),ts=es))||ts)||ts)||ts)||ts));dt(ge.prototype,"MeshRenderer.prototype",[{name:"enableDynamicBatching"},{name:"recieveShadows"}]),_t(_a,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),_t(_a.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),G.CameraComponent=_a,mt.setClassAlias(_a,"cc.CameraComponent"),G.LightComponent=ds,mt.setClassAlias(ds,"cc.LightComponent"),G.DirectionalLightComponent=_s,mt.setClassAlias(_s,"cc.DirectionalLightComponent"),G.SphereLightComponent=ms,mt.setClassAlias(ms,"cc.SphereLightComponent"),G.SpotLightComponent=gs,mt.setClassAlias(gs,"cc.SpotLightComponent"),G.ModelComponent=ge,mt.setClassAlias(ge,"cc.ModelComponent"),G.SkinningModelComponent=ta,mt.setClassAlias(ta,"cc.SkinningModelComponent"),G.SkinningModelUnit=na,mt.setClassAlias(na,"cc.SkinningModelUnit"),G.BatchedSkinningModelComponent=oa,mt.setClassAlias(oa,"cc.BatchedSkinningModelComponent"),G.utils=Mi;var vs,ys,bs,ws,ks=t("U",K("cc.animation.UniformProxyFactory")((hs=J((us=function(){function t(e,i){V(this,t),tt(this,"passIndex",hs,this),tt(this,"uniformName",ls,this),tt(this,"channelIndex",cs,this),this.passIndex=i||0,this.uniformName=e||""}return j(t,[{key:"forTarget",value:function(t){var e=t.passes[this.passIndex],i=e.getHandle(this.uniformName);if(!i)throw new Error('Material "'.concat(t.name,'" has no uniform "').concat(this.uniformName,'"'));var r=Ue.getPropertyTypeFromHandle(i);if(r===He.UBO){var n=void 0===this.channelIndex?i:e.getHandle(this.uniformName,this.channelIndex,Ce.FLOAT);if(!n)throw new Error('Uniform "'.concat(this.uniformName," (in material ").concat(t.name,") has no channel ").concat(this.channelIndex,'"'));return function(t,e){for(var i,r=yt(t.shaderInfo.blocks);!(i=r()).done;)for(var n,a=i.value,s=yt(a.members);!(n=s()).done;){var o=n.value;if(o.name===e)return o.count>1}return!1}(e,this.uniformName)?{set:function(t){e.setUniformArray(n,t)}}:{set:function(t){e.setUniform(n,t)}}}if(r===He.SAMPLER){var a=Ue.getBindingFromHandle(i),s=e.properties[this.uniformName],o=s&&s.value?s.value+"-texture":Ge(s.type),u=qe.get(o);return u||(vt("Illegal texture default value: ".concat(o,".")),u=qe.get("default-texture")),{set:function(t){t||(t=u);var i=t.getGFXTexture();i&&i.width&&i.height&&(e.bindTexture(a,i),t instanceof Ke&&e.bindSampler(a,te.getSampler(G.game._gfxDevice,t.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type ".concat(r,"."))}}]),t}()).prototype,"passIndex",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ls=J(us.prototype,"uniformName",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),cs=J(us.prototype,"channelIndex",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),os=us))||os);var Ss,Ts,xs,As,Is;t("M",K("cc.animation.MorphWeightsValueProxy")((bs=J((ys=function(){function t(){V(this,t),tt(this,"subMeshIndex",bs,this)}return j(t,[{key:"forTarget",value:function(t){var e=this;return{set:function(i){t.setWeights(i,e.subMeshIndex)}}}}]),t}()).prototype,"subMeshIndex",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vs=ys))||vs),t("a",K("cc.animation.MorphWeightsAllValueProxy")(ws=function(){function t(){V(this,t)}return j(t,[{key:"forTarget",value:function(t){return{set:function(e){for(var i,r,n=null!==(i=null===(r=t.mesh)||void 0===r?void 0:r.struct.primitives.length)&&void 0!==i?i:0,a=0;a<n;++a)t.setWeights(e,a)}}}}]),t}())||ws);function Es(t,e,i,r){var n,a,s,o,h,l=new e,c=new e,p=new e,f=K(t)((s=J((a=function(){function t(i,r,n){V(this,t),tt(this,"dataPoint",s,this),tt(this,"inTangent",o,this),tt(this,"outTangent",h,this),this.dataPoint=i||new e,this.inTangent=r||new e,this.outTangent=n||new e}return j(t,[{key:"lerp",value:function(t,e,n){var a=this.dataPoint,s=t.dataPoint;c=i(c,this.inTangent,n),p=i(p,t.outTangent,n);var o=e*e*e,u=e*e,h=o-2*u+e,f=-2*o+3*u,d=o-u;return l=i(l,a,2*o-3*u+1),l=r(l,l,c,h),l=r(l,l,s,f),l=r(l,l,p,d)}},{key:"getNoLerp",value:function(){return this.dataPoint}}]),t}()).prototype,"dataPoint",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),o=J(a.prototype,"inTangent",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),h=J(a.prototype,"outTangent",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),n=a))||n;if(e===u){var d=f.prototype.lerp;f.prototype.lerp=function(t,e,i){var r=d.call(this,t,e,i);return u.normalize(r,r),r}}return f}var Cs=t("C",Es("cc.CubicSplineVec2Value",i,i.multiplyScalar,i.scaleAndAdd));G.CubicSplineVec2Value=Cs;var Ps=t("b",Es("cc.CubicSplineVec3Value",n,n.multiplyScalar,n.scaleAndAdd));G.CubicSplineVec3Value=Ps;var Ms=t("c",Es("cc.CubicSplineVec4Value",s,s.multiplyScalar,s.scaleAndAdd));G.CubicSplineVec4Value=Ms;var Ns=t("d",Es("cc.CubicSplineQuatValue",u,u.multiplyScalar,u.scaleAndAdd));G.CubicSplineQuatValue=Ns;var Os=t("e",K("cc.CubicSplineNumberValue")((xs=J((Ts=function(){function t(e,i,r){V(this,t),tt(this,"dataPoint",xs,this),tt(this,"inTangent",As,this),tt(this,"outTangent",Is,this),this.dataPoint=e,this.inTangent=i,this.outTangent=r}return j(t,[{key:"lerp",value:function(t,e,i){var r=this.dataPoint,n=t.dataPoint,a=e*e*e,s=e*e;return r*(2*a-3*s+1)+this.outTangent*i*(a-2*s+e)+n*(-2*a+3*s)+t.inTangent*i*(a-s)}},{key:"getNoLerp",value:function(){return this.dataPoint}}]),t}()).prototype,"dataPoint",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),As=J(Ts.prototype,"inTangent",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Is=J(Ts.prototype,"outTangent",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ss=Ts))||Ss);function Rs(t){return t*t}function Ds(t){return t*(2-t)}function zs(t){return t*t*t}function Bs(t){return--t*t*t+1}function Fs(t){return t*t*t*t}function Ls(t){return 1- --t*t*t*t}function js(t){return t*t*t*t*t}function Vs(t){return--t*t*t*t*t+1}function Ws(t){return 1-Math.cos(t*Math.PI/2)}function Us(t){return Math.sin(t*Math.PI/2)}function Hs(t){return 0===t?0:Math.pow(1024,t-1)}function Gs(t){return 1===t?1:1-Math.pow(2,-10*t)}function qs(t){return 1-Math.sqrt(1-t*t)}function Ks(t){return Math.sqrt(1- --t*t)}function Xs(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))}function Ys(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)}function Js(t){var e=1.70158;return t*t*((e+1)*t-e)}function Qs(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}function Zs(t){return 1-$s(1-t)}function $s(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}G.CubicSplineNumberValue=Os;var to=lo(Rs,Ds),eo=lo(zs,Bs),io=lo(Fs,Ls),ro=lo(js,Vs),no=lo(Ws,Us),ao=lo(Hs,Gs),so=lo(qs,Ks),oo=lo(Xs,Ys),uo=lo(Js,Qs),ho=lo(Zs,$s);function lo(t,e){return function(i){return i<.5?e(2*i)/2:t(2*i-1)/2+.5}}var co=Object.freeze({__proto__:null,constant:function(){return 0},linear:function(t){return t},quadIn:Rs,quadOut:Ds,quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:zs,cubicOut:Bs,cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:Fs,quartOut:Ls,quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:js,quintOut:Vs,quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:Ws,sineOut:Us,sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:Hs,expoOut:Gs,expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:qs,circOut:Ks,circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:Xs,elasticOut:Ys,elasticInOut:function(t){var e,i=.1,r=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=r*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)*.5+1)},backIn:Js,backOut:Qs,backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:Zs,bounceOut:$s,bounceInOut:function(t){return t<.5?.5*Zs(2*t):.5*$s(2*t-1)+.5},smooth:function(t){return t<=0?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)},quadOutIn:to,cubicOutIn:eo,quartOutIn:io,quintOutIn:ro,sineOutIn:no,expoOutIn:ao,circOutIn:so,elasticOutIn:oo,backOutIn:uo,bounceOutIn:ho});t("n",co);function po(t,e){for(var i=0,r=t.length-1,n=r>>>1;i<=r;n=i+r>>>1){var a=t[n];if(a>e+1e-6)r=n-1;else{if(!(a<e-1e-6))return n;i=n+1}}return~i}function fo(t,e,i,r,n){var a=1-n;return t*a*a*a+3*e*a*a*n+3*i*a*n*n+r*n*n*n}G.bezier=fo;var _o=Math.cos,mo=Math.acos,go=Math.max,vo=2*Math.PI,yo=Math.sqrt;function bo(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function wo(t,e){var i=function(t,e){var i,r,n,a,s=e-0,o=e-t[0],u=3*s,h=3*o,l=3*(e-t[2]),c=1/(-s+h-l+(e-1)),p=(u-6*o+l)*c,f=p*(1/3),d=(-u+h)*c,_=1/3*(3*d-p*p),m=_*(1/3),g=(2*p*p*p-9*p*d+27*(s*c))/27,v=g/2,y=v*v+m*m*m;if(y<0){var b=1/3*-_,w=yo(b*b*b),k=-g/(2*w),S=mo(k<-1?-1:k>1?1:k),T=2*bo(w);return r=T*_o(S*(1/3))-f,n=T*_o((S+vo)*(1/3))-f,a=T*_o((S+2*vo)*(1/3))-f,0<=r&&r<=1?0<=n&&n<=1?0<=a&&a<=1?go(r,n,a):go(r,n):0<=a&&a<=1?go(r,a):r:0<=n&&n<=1?0<=a&&a<=1?go(n,a):n:a}if(0===y)return n=-(i=v<0?bo(-v):-bo(v))-f,0<=(r=2*i-f)&&r<=1?0<=n&&n<=1?go(r,n):r:n;var x=yo(y);return r=(i=bo(-v+x))-bo(v+x)-f}(t,e),r=1-i;return 0*r*r*r+3*t[1]*i*r*r+3*t[3]*i*i*r+1*i*i*i}G.bezierByTime=wo;var ko=t("R",function(){function t(e){var i,r;V(this,t),this.ratios=void 0,this._findRatio=void 0,this.ratios=e;for(var n=!0,a=1,s=e.length;a<s;a++)if(i=e[a]-e[a-1],1===a)r=i;else if(Math.abs(i-r)>1e-6){n=!1;break}this._findRatio=n?Ao:po}return j(t,[{key:"sample",value:function(t){return this._findRatio(this.ratios,t)}}]),t}());G.RatioSampler=ko;var So=t("z",function(){function t(e,i){V(this,t),this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=i,this._values=e.values;var r=function(e){return"string"==typeof e?e:Array.isArray(e)?e[0]===e[1]&&e[2]===e[3]?t.Linear:t.Bezier(e):t.Linear};if(void 0!==e.easingMethod)this.type=r(e.easingMethod);else if(Array.isArray(e.easingMethods))this.types=e.easingMethods.map(r);else if(void 0!==e.easingMethods){this.types=new Array(this._values.length).fill(null);for(var n=0,a=Object.keys(e.easingMethods);n<a.length;n++){var s=a[n];this.types[s]=r(e.easingMethods[s])}}else this.type=null;var o=e.values[0];(void 0===e.interpolate||e.interpolate)&&(this._lerp=Vo(o)),void 0!==e._arrayLength&&(this._array=new Array(e._arrayLength))}return j(t,null,[{key:"Bezier",value:function(t){return t}}]),j(t,[{key:"hasLerp",value:function(){return!!this._lerp}},{key:"valueAt",value:function(t){if(void 0===this._array){var e=this._values[t];return e&&e.getNoLerp?e.getNoLerp():e}for(var i=0;i<this._array.length;++i)this._array[i]=this._values[this._array.length*t+i];return this._array}},{key:"valueBetween",value:function(t,e,i,r,n){if(this._lerp){var a=this.types?this.types[e]:this.type,s=n-i,o=(t-i)/s;if(a&&(o=xo(o,a)),void 0===this._array){var u=this._values[e],h=this._values[r];return this._lerp(u,h,o,s*this._duration)}for(var l=0;l<this._array.length;++l){var c=this._values[this._array.length*e+l],p=this._values[this._array.length*r+l];this._array[l]=this._lerp(c,p,o,s*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(e);for(var f=0;f<this._array.length;++f)this._array[f]=this._values[this._array.length*e+f];return this._array}},{key:"empty",value:function(){return 0===this._values.length}},{key:"constant",value:function(){return 1===this._values.length}}]),t}());So.Linear=null,G.AnimCurve=So;t("E",function(){function t(){V(this,t),this.events=[]}return j(t,[{key:"add",value:function(t,e){this.events.push({func:t||"",params:e||[]})}}]),t}());function To(t,e,i){var r=e.sample(i);if(r<0)if((r=~r)<=0)r=0;else{if(!(r>=e.ratios.length))return t.valueBetween(i,r-1,e.ratios[r-1],r,e.ratios[r]);r=e.ratios.length-1}return t.valueAt(r)}function xo(t,e){if("string"==typeof e){var i=co[e];i?t=i(t):bt(3906,e)}else Array.isArray(e)&&(t=wo(e,t));return t}function Ao(t,e){var i=t.length-1;if(0===i)return 0;var r=t[0];if(e<r)return 0;var n=t[i];if(e>n)return i;var a=(e=(e-r)/(n-r))/(1/i),s=0|a;return a-s<1e-6?s:s+1-a<1e-6?s+1:~(s+1)}G.sampleAnimationCurve=To;var Io,Eo,Co,Po,Mo,No,Oo,Ro,Do,zo,Bo,Fo,Lo,jo,Vo=function(){function t(t,e,i,r){return t.lerp(e,i,r)}return function(e){if(null!==e){if("number"==typeof e)return x;if("object"===wt(e)&&e.constructor){if(e instanceof u)return i=new u,function(t,e,r,n){return u.slerp(i,t,e,r)};if(e instanceof kt)return function(t){var e=new t;return function(i,r,n){return t.lerp(e,i,r,n),e}}(e.constructor);if(e.constructor===Number)return x;if(Xe(e))return t}var i}}}(),Wo=t("I",K("cc.AnimationClip")((jo=Lo=function(t){function e(){var t,i;V(this,e);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return i=U(this,(t=H(e)).call.apply(t,[this].concat(n))),tt(i,"sample",Co,et(i)),tt(i,"speed",Po,et(i)),tt(i,"wrapMode",Mo,et(i)),tt(i,"events",No,et(i)),tt(i,"_duration",Oo,et(i)),tt(i,"_keys",Ro,et(i)),tt(i,"_stepness",Do,et(i)),tt(i,"_curves",zo,et(i)),tt(i,"_commonTargets",Bo,et(i)),tt(i,"_hash",Fo,et(i)),i.frameRate=0,i._ratioSamplers=[],i._runtimeCurves=void 0,i._runtimeEvents=void 0,i._data=null,i}return W(e,t),j(e,[{key:"onLoaded",value:function(){this.frameRate=this.sample,this._decodeCVTAs()}},{key:"getPropertyCurves",value:function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves}},{key:"updateEventDatas",value:function(){delete this._runtimeEvents}},{key:"getEventGroupIndexAtRatio",value:function(t){return this._runtimeEvents||this._createRuntimeEvents(),function(t,e){for(var i=0,r=t.length-1,n=r>>>1;i<=r;n=i+r>>>1){var a=t[n];if(a>e+1e-6)r=n-1;else{if(!(a<e-1e-6))return n;i=n+1}}return~i}(this._runtimeEvents.ratios,t)}},{key:"hasEvents",value:function(){return 0!==this.events.length}},{key:"destroy",value:function(){return G.director.root.dataPoolManager.releaseAnimationClip(this),Qe.destroy(this),q(H(e.prototype),"destroy",this).call(this)}},{key:"_createPropertyCurves",value:function(){var t=this;this._ratioSamplers=this._keys.map((function(e){return new ko(e.map((function(e){return e/t._duration})))})),this._runtimeCurves=this._curves.map((function(e){return{curve:new So(e.data,t._duration),modifiers:e.modifiers,valueAdapter:e.valueAdapter,sampler:t._ratioSamplers[e.data.keys],commonTarget:e.commonTarget}})),this._applyStepness()}},{key:"_createRuntimeEvents",value:function(){for(var t,e=this,i=[],r=[],n=this.events.sort((function(t,e){return t.frame-e.frame})),a=function(){var n=t.value,a=n.frame/e._duration,s=i.findIndex((function(t){return t===a}));s<0&&(s=i.length,i.push(a),r.push({events:[]})),r[s].events.push({functionName:n.func,parameters:n.params})},s=yt(n);!(t=s()).done;)a();this._runtimeEvents={ratios:i,eventGroups:r}}},{key:"_applyStepness",value:function(){this._runtimeCurves}},{key:"_decodeCVTAs",value:function(){var t=ArrayBuffer.isView(this._nativeAsset)?this._nativeAsset.buffer:this._nativeAsset;if(t){for(var e=this._keys,i=0;i<e.length;++i){var r=e[i];r instanceof Ze&&(e[i]=r.decompress(t))}for(var n=0;n<this._curves.length;++n){var a=this._curves[n];a.data.values instanceof Ze&&(a.data.values=a.data.values.decompress(t))}}}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}},{key:"keys",get:function(){return this._keys},set:function(t){this._keys=t}},{key:"eventGroups",get:function(){return this._runtimeEvents||this._createRuntimeEvents(),this._runtimeEvents.eventGroups}},{key:"stepness",get:function(){return this._stepness},set:function(t){this._stepness=t,this._applyStepness()}},{key:"hash",get:function(){if(this._hash)return this._hash;var t=this._nativeAsset,e=new Uint8Array(ArrayBuffer.isView(t)?t.buffer:t);return this._hash=$e(e,666)}},{key:"curves",get:function(){return this._curves},set:function(t){this._curves=t,delete this._runtimeCurves}},{key:"data",get:function(){return this._data}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(t){this._commonTargets=t}}],[{key:"createWithSpriteFrames",value:function(t,i){if(!Array.isArray(t))return bt(3905),null;var r=new e;r.sample=i||r.sample,r.duration=t.length/r.sample;for(var n=1/r.sample,a=new Array(t.length),s=new Array(a.length),o=0;o<t.length;o++)a[o]=o*n,s[o]=t[o];return r.keys=[a],r.curves=[{modifiers:[new Je("cc.Sprite"),"spriteFrame"],data:{keys:0,values:s}}],r}}]),e}(St),Lo.preventDeferredLoadDependents=!0,Lo.WrapMode=Ye,Co=J((Eo=jo).prototype,"sample",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),Po=J(Eo.prototype,"speed",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Mo=J(Eo.prototype,"wrapMode",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ye.Normal}}),No=J(Eo.prototype,"events",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Oo=J(Eo.prototype,"_duration",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ro=J(Eo.prototype,"_keys",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Do=J(Eo.prototype,"_stepness",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zo=J(Eo.prototype,"_curves",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bo=J(Eo.prototype,"_commonTargets",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fo=J(Eo.prototype,"_hash",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Io=Eo))||Io);function Uo(t,e,i){var r,n=e[e.length-1];if(0!==e.length&&ti(n)&&!i){var a=ei.apply(void 0,[t].concat(xt(e.slice(0,e.length-1))));if(null===a)return null;r={isProxy:!1,object:a,property:n}}else{if(!i)return Tt("Empty animation curve."),null;var s=ei.apply(void 0,[t].concat(xt(e)));if(null===s)return null;r={isProxy:!0,proxy:i.forTarget(s)}}return{setValue:function(t){r.isProxy?r.proxy.set(t):r.object[r.property]=t},getValue:function(){return r.isProxy?r.proxy.get?r.proxy.get():(Tt("Target doesn't provide a get method."),null):r.object[r.property]}}}function Ho(t,e,i){var r=Uo(t,e,i);if(null===r)return null;var n=r.getValue(),a=qo(n);if(!a)return Tt("Value is not copyable!"),null;var s=a.createBuffer(),o=a.copy;return Object.assign(r,{peek:function(){return s},pull:function(){var t=r.getValue();o(s,t)},push:function(){r.setValue(s)}})}G.AnimationClip=Wo;var Go,qo=((Go=new Map).set(i,{createBuffer:function(){return new i},copy:i.copy}),Go.set(n,{createBuffer:function(){return new n},copy:n.copy}),Go.set(s,{createBuffer:function(){return new s},copy:s.copy}),Go.set(v,{createBuffer:function(){return new v},copy:v.copy}),function(t){return Go.get(null==t?void 0:t.constructor)}),Ko=function(){function t(){V(this,t),this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}return j(t,[{key:"play",value:function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(At(3912)):(this._isPlaying=!0,this.onPlay())}},{key:"stop",value:function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)}},{key:"pause",value:function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())}},{key:"resume",value:function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())}},{key:"step",value:function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()}},{key:"update",value:function(t){}},{key:"onPlay",value:function(){}},{key:"onPause",value:function(){}},{key:"onResume",value:function(){}},{key:"onStop",value:function(){}},{key:"onError",value:function(t){}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t}(),Xo=function(){function t(){V(this,t),this._nodeBlendStates=new Map,this._states=new Set}return j(t,[{key:"ref",value:function(t,e){var i=this._nodeBlendStates.get(t);i||(i={dirty:!1,properties:{}},this._nodeBlendStates.set(t,i));var r=i.properties[e];return r||(r=i.properties[e]=new Qo(i,Yo(e)?new n:new u)),++r.refCount,r}},{key:"deRef",value:function(t,e){var i=this._nodeBlendStates.get(t);if(i){var r=i.properties[e];r&&(--r.refCount,r.refCount>0||(delete i.properties[e],function(t){return!(t.properties.position||t.properties.rotation||t.properties.eulerAngles||t.properties.scale)}(i)&&this._nodeBlendStates.delete(t)))}}},{key:"apply",value:function(){this._nodeBlendStates.forEach((function(t,e){if(t.dirty){t.dirty=!1;var i,r,n,a=t.properties,s=a.position,o=a.scale,u=a.rotation,h=a.eulerAngles,l=!1;s&&0!==s.weight&&(s.weight=0,i=s.value,l=!0),o&&0!==o.weight&&(o.weight=0,r=o.value,l=!0),u&&0!==u.weight&&(u.weight=0,n=u.value,l=!0),h&&0!==h.weight&&(h.weight=0,n=h.value,l=!0),l&&e.setRTS(n,i,r)}})),this._states.forEach((function(t){t.onBlendFinished()}))}},{key:"bindState",value:function(t){this._states.add(t)}},{key:"unbindState",value:function(t){this._states.delete(t)}}]),t}();function Yo(t){return!function(t){return"rotation"===t}(t)}var Jo,Qo=function(){function t(e,i){V(this,t),this.weight=0,this.value=void 0,this.refCount=0,this._node=void 0,this._node=e,this.value=i}return j(t,[{key:"markAsDirty",value:function(){this._node.dirty=!0}}]),t}();function Zo(t,e,i){return 0===i.weight&&n.zero(i.value),0===e?i.value:1===e?n.copy(i.value,t):n.scaleAndAdd(i.value,i.value,t,e)}function $o(t,e,i){if(0===i.weight&&u.identity(i.value),0===e)return i.value;if(1===e)return u.copy(i.value,t);var r=e/(i.weight+e);return u.slerp(i.value,i.value,t,r)}!function(t){t.PLAY="play",t.STOP="stop",t.PAUSE="pause",t.RESUME="resume",t.LASTFRAME="lastframe",t.FINISHED="finished"}(Jo||(Jo={})),It(Jo);var tu=function(){function t(e,i,r){V(this,t),this.commonTargetIndex=void 0,this._curve=void 0,this._boundTarget=void 0,this._rootTargetProperty=void 0,this._curveDetail=void 0,this._curve=e.curve,this._curveDetail=e,this._boundTarget=r}return j(t,[{key:"applySample",value:function(t,e,i,r,n){var a;this._curve.empty()||(a=this._curve.hasLerp()&&i?this._curve.valueBetween(t,r.from,r.fromRatio,r.to,r.toRatio):this._curve.valueAt(e),this._setValue(a,n))}},{key:"_setValue",value:function(t,e){this._boundTarget.setValue(t)}},{key:"propertyName",get:function(){return this._rootTargetProperty||""}},{key:"curveDetail",get:function(){return this._curveDetail}}]),t}();var eu=t("A",function(t){function e(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return V(this,e),(i=U(this,H(e).call(this))).duration=1,i.speed=1,i.time=0,i.weight=0,i.frameRate=0,i._wrapMode=Ye.Normal,i._repeatCount=1,i._currentFramePlayed=!1,i._delay=0,i._delayTime=0,i._wrappedInfo=new ii,i._lastWrapInfo=null,i._lastWrapInfoEvent=null,i._process=i.process,i._target=null,i._targetNode=null,i._clip=void 0,i._name=void 0,i._lastIterations=void 0,i._samplerSharedGroups=[],i._commonTargetStatuses=[],i._curveLoaded=!1,i._ignoreIndex=-1,i._blendStateBuffer=null,i._blendStateWriters=[],i._allowLastFrame=!1,i._blendStateWriterHost={weight:0,enabled:!1},i._clip=t,i._name=r||t&&t.name,i}return W(e,t),j(e,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(t){this._wrapMode=t,this.time=0,t&ri.Loop?this.repeatCount=1/0:this.repeatCount=1}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t;var e=this._wrapMode&ri.ShouldWrap,i=(this.wrapMode&ri.Reverse)===ri.Reverse;this._process=t!==1/0||e||i?this.process:this.simpleProcess}},{key:"delay",get:function(){return this._delay},set:function(t){this._delayTime=this._delay=t}}]),j(e,[{key:"initialize",value:function(t,e){var i,r,n=this;if(!this._curveLoaded){this._curveLoaded=!0,this._destroyBlendStateWriters(),this._samplerSharedGroups.length=0,this._blendStateBuffer=null!==(i=null===(r=G.director.getAnimationManager())||void 0===r?void 0:r.blendState)&&void 0!==i?i:null,this._blendStateBuffer&&this._blendStateBuffer.bindState(this),this._targetNode=t;var a=this._clip;this.duration=a.duration,this.speed=a.speed,this.wrapMode=a.wrapMode,this.frameRate=a.sample,(this.wrapMode&ri.Loop)===ri.Loop?this.repeatCount=1/0:this.repeatCount=1;var s=function(t,e,i,r,a){if(!function(t){var e;if(1===t.length&&"string"==typeof t[0])e=t[0];else if(t.length>1){for(var i=0;i<t.length-1;++i)if(!(t[i]instanceof ni))return!1;e=t[t.length-1]}switch(e){case"position":case"scale":case"rotation":case"eulerAngles":return!0;default:return!1}}(i)||!n._blendStateBuffer)return t(e,i,r);var s,o,u,h,l,c,p,f,d,_=ei.apply(void 0,[e].concat(xt(i.slice(0,i.length-1))));if(null!==_&&_ instanceof de){var m=i[i.length-1],g=(s=n._blendStateBuffer,o=_,u=m,h=n._blendStateWriterHost,l=a,c=Yo(u)?Zo:$o,p=s.ref(o,u),f=!1,d=-1,{destroy:function(){p&&(s.deRef(o,u),p=null)},forTarget:function(){return{get:function(){return o[u]},set:function(t){if(p&&h.enabled){var e=h.weight;if(l)if(1!==e||e!==d)f=!1;else if(f)return;c(t,e,p),p.weight+=e,p.markAsDirty(),f=!0,d=e}}}}});return n._blendStateWriters.push(g),t(e,[],g)}return null};this._commonTargetStatuses=a.commonTargets.map((function(e,i){var r=s(Ho,t,e.modifiers,e.valueAdapter,!1);return null===r?null:{target:r,changed:!1}})),e||(e=a.getPropertyCurves());for(var o=function(i){var r=e[i],a=n._samplerSharedGroups.find((function(t){return t.sampler===r.sampler}));a||(a={sampler:r.sampler,curves:[],samplerResultCache:{from:0,fromRatio:0,to:0,toRatio:0}},n._samplerSharedGroups.push(a));var o=void 0;if(void 0===r.commonTarget)o=t;else{var u=n._commonTargetStatuses[r.commonTarget];if(!u)return"continue";o=u.target.peek()}var h=s(Uo,o,r.modifiers,r.valueAdapter,r.curve.constant());if(null===h);else{var l=new tu(r,o,h);l.commonTargetIndex=r.commonTarget,a.curves.push(l)}},u=0;u<e.length;++u)o(u)}}},{key:"destroy",value:function(){this._destroyBlendStateWriters()}},{key:"onBlendFinished",value:function(){this._blendStateWriterHost.enabled=!1}},{key:"emit",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];G.director.getAnimationManager().pushDelayEvent(this._emit,this,e)}},{key:"on",value:function(t,e,i){return this._target&&this._target.isValid?this._target.on(t,e,i):null}},{key:"once",value:function(t,e,i){return this._target&&this._target.isValid?this._target.once(t,e,i):null}},{key:"off",value:function(t,e,i){this._target&&this._target.isValid&&this._target.off(t,e,i)}},{key:"allowLastFrameEvent",value:function(t){this._allowLastFrame=t}},{key:"_setEventTarget",value:function(t){this._target=t}},{key:"setTime",value:function(t){this._currentFramePlayed=!1,this.time=t||0,this._lastWrapInfoEvent=null,this._ignoreIndex=-1;var e=this.getWrappedInfo(t,this._wrappedInfo),i=e.direction,r=this._clip.getEventGroupIndexAtRatio(e.ratio);r<0&&(r=~r-1,i<0&&(r+=1),this._ignoreIndex=r)}},{key:"update",value:function(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())}},{key:"_needReverse",value:function(t){var e=this.wrapMode,i=!1;(e&ri.PingPong)===ri.PingPong&&(t-(0|t)==0&&t>0&&(t-=1),1&t&&(i=!i));return(e&ri.Reverse)===ri.Reverse&&(i=!i),i}},{key:"getWrappedInfo",value:function(t,e){e=e||new ii;var i=!1,r=this.duration,n=this.repeatCount,a=t>0?t/r:-t/r;if(a>=n){a=n,i=!0;var s=n-(0|n);0===s&&(s=1),t=s*r*(t>0?1:-1)}if(t>r){var o=t%r;t=0===o?r:o}else t<0&&0!==(t%=r)&&(t+=r);var u=!1,h=this._wrapMode&ri.ShouldWrap;h&&(u=this._needReverse(a));var l=u?-1:1;return this.speed<0&&(l*=-1),h&&u&&(t=r-t),e.ratio=t/r,e.time=t,e.direction=l,e.stopped=i,e.iterations=a,e}},{key:"sample",value:function(){var t=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(t.ratio),this._sampleEvents(t),t}},{key:"process",value:function(){var t,e=this.sample();this._allowLastFrame&&(t=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new ii(e),this.repeatCount>1&&(0|e.iterations)>(0|t.iterations)&&this.emit(Jo.LASTFRAME,this),t.set(e));e.stopped&&(this.stop(),this.emit(Jo.FINISHED,this))}},{key:"simpleProcess",value:function(){var t=this.duration,e=this.time%t;e<0&&(e+=t);var i=e/t;this._sampleCurves(i),this._clip.hasEvents()&&this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(void 0===this._lastIterations&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(Jo.LASTFRAME,this),this._lastIterations=i)}},{key:"cache",value:function(t){}},{key:"onPlay",value:function(){this.setTime(0),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(Jo.PLAY,this)}},{key:"onStop",value:function(){this.isPaused||this._onPauseOrStop(),this.emit(Jo.STOP,this)}},{key:"onResume",value:function(){this._onReplayOrResume(),this.emit(Jo.RESUME,this)}},{key:"onPause",value:function(){this._onPauseOrStop(),this.emit(Jo.PAUSE,this)}},{key:"_sampleCurves",value:function(t){this._blendStateWriterHost.weight=this.weight,this._blendStateWriterHost.enabled=!0;for(var e=0;e<this._commonTargetStatuses.length;++e){var i=this._commonTargetStatuses[e];i&&(i.target.pull(),i.changed=!1)}for(var r=0,n=this._samplerSharedGroups.length;r<n;++r){var a=this._samplerSharedGroups[r],s=a.sampler,o=a.samplerResultCache,u=0,h=!1;s?(u=s.sample(t))<0&&((u=~u)<=0?u=0:u>=s.ratios.length?u=s.ratios.length-1:(h=!0,o.from=u-1,o.fromRatio=s.ratios[o.from],o.to=u,o.toRatio=s.ratios[o.to],u=o.from)):u=0;for(var l=0,c=a.curves.length;l<c;++l){var p=a.curves[l];if(p.applySample(t,u,h,o,this.weight),void 0!==p.commonTargetIndex){var f=this._commonTargetStatuses[p.commonTargetIndex];f&&(f.changed=!0)}}}for(var d=0;d<this._commonTargetStatuses.length;++d){var _=this._commonTargetStatuses[d];_&&(_.changed&&_.target.push())}}},{key:"_sampleEvents",value:function(t){var e=this._clip.eventGroups.length,i=t.direction,r=this._clip.getEventGroupIndexAtRatio(t.ratio);if(r<0&&(r=~r-1,i<0&&(r+=1)),this._ignoreIndex!==r&&(this._ignoreIndex=-1),t.frameIndex=r,!this._lastWrapInfoEvent)return this._fireEvent(r),void(this._lastWrapInfoEvent=new ii(t));var n=this.wrapMode,a=iu(t.iterations),s=this._lastWrapInfoEvent,o=iu(s.iterations),u=s.frameIndex,h=s.direction,l=-1!==o&&a!==o;if(u===r&&l&&1===e)this._fireEvent(0);else if(u!==r||l){i=h;do{if(u!==r){if(-1===i&&0===u&&r>0?((n&ri.PingPong)===ri.PingPong?i*=-1:u=e,o++):1===i&&u===e-1&&r<e-1&&((n&ri.PingPong)===ri.PingPong?i*=-1:u=-1,o++),u===r)break;if(o>a)break}u+=i,G.director.getAnimationManager().pushDelayEvent(this._fireEvent,this,[u])}while(u!==r&&u>-1&&u<e)}this._lastWrapInfoEvent.set(t)}},{key:"_emit",value:function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)}},{key:"_fireEvent",value:function(t){if(this._targetNode&&this._targetNode.isValid){var e=this._clip.eventGroups;if(!(t<0||t>=e.length||this._ignoreIndex===t))for(var i,r=e[t],n=this._targetNode.components,a=yt(r.events);!(i=a()).done;)for(var s,o=i.value,u=o.functionName,h=yt(n);!(s=h()).done;){var l=s.value,c=l[u];"function"==typeof c&&c.apply(l,o.parameters)}}}},{key:"_onReplayOrResume",value:function(){G.director.getAnimationManager().addAnimation(this)}},{key:"_onPauseOrStop",value:function(){G.director.getAnimationManager().removeAnimation(this)}},{key:"_destroyBlendStateWriters",value:function(){for(var t=0;t<this._blendStateWriters.length;++t)this._blendStateWriters[t].destroy();this._blendStateWriters.length=0,this._blendStateBuffer&&(this._blendStateBuffer.unbindState(this),this._blendStateBuffer=null),this._blendStateWriterHost.enabled=!1}},{key:"curveLoaded",get:function(){return this._curveLoaded}}]),e}(Ko));function iu(t){return t-(0|t)==0&&(t-=1),0|t}G.AnimationState=eu;var ru,nu,au,su,ou,uu,hu,lu,cu,pu,fu,du,_u,mu,gu,vu,yu,bu=function(t){function e(){var t;return V(this,e),(t=U(this,H(e).call(this)))._managedStates=[],t._fadings=[],t}return W(e,t),j(e,[{key:"update",value:function(t){if(!this.isMotionless){for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&(i.weight=0)}for(var r=1,n=this._fadings.length,a=0;a<this._fadings.length;++a){var s=this._fadings[a];s.easeTime+=t;var o=0===s.easeDuration?1:T(s.easeTime/s.easeDuration),u=o*r;if(r*=1-o,s.target.state&&(s.target.state.weight+=u),s.easeTime>=s.easeDuration){n=a+1,s.easeTime=s.easeDuration;break}}if(n!==this._fadings.length){for(var h=n;h<this._fadings.length;++h){var l=this._fadings[h];--l.target.reference,l.target.reference<=0&&(l.target.state&&l.target.state.stop(),Et(this._managedStates,l.target))}this._fadings.splice(n)}for(var c=0;c<this._managedStates.length;++c){var p=this._managedStates[c].state;p&&p.isMotionless&&p.sample()}}}},{key:"crossFade",value:function(t,e){var i;0===this._managedStates.length&&(e=0),0===e&&this.clear();var r=this._managedStates.find((function(e){return e.state===t}));r?(null===(i=r.state)||void 0===i?void 0:i.isMotionless)&&r.state.play():(r={state:t,reference:0},t&&t.play(),this._managedStates.push(r)),++r.reference,this._fadings.unshift({easeDuration:e,easeTime:0,target:r})}},{key:"clear",value:function(){for(var t=0;t<this._managedStates.length;++t){var e=this._managedStates[t].state;e&&e.stop()}this._managedStates.length=0,this._fadings.length=0}},{key:"onPlay",value:function(){q(H(e.prototype),"onPlay",this).call(this),G.director.getAnimationManager().addCrossFade(this)}},{key:"onPause",value:function(){q(H(e.prototype),"onPause",this).call(this),G.director.getAnimationManager().removeCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var i=this._managedStates[t].state;i&&i.pause()}}},{key:"onResume",value:function(){q(H(e.prototype),"onResume",this).call(this),G.director.getAnimationManager().addCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var i=this._managedStates[t].state;i&&i.resume()}}},{key:"onStop",value:function(){q(H(e.prototype),"onStop",this).call(this),G.director.getAnimationManager().removeCrossFade(this),this.clear()}}]),e}(Ko),wu=t("v",(ru=K("cc.Animation"),nu=Q(),au=_e(99),su=Z(),ou=X([Wo]),uu=$(),hu=X(Wo),lu=$(),cu=$(),pu=X([Wo]),ru(fu=nu(fu=au(fu=Y(fu=su((yu=vu=function(t){function e(){var t,i;V(this,e);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return i=U(this,(t=H(e)).call.apply(t,[this].concat(n))),tt(i,"playOnLoad",_u,et(i)),i._crossFade=new bu,i._nameToState=Pt(!0),tt(i,"_clips",mu,et(i)),tt(i,"_defaultClip",gu,et(i)),i._hasBeenPlayed=!1,i}return W(e,t),j(e,[{key:"onLoad",value:function(){for(var t in this.clips=this._clips,this._nameToState){this._nameToState[t].initialize(this.node)}}},{key:"start",value:function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)}},{key:"onEnable",value:function(){this._crossFade.resume()}},{key:"onDisable",value:function(){this._crossFade.pause()}},{key:"onDestroy",value:function(){for(var t in this._crossFade.stop(),this._nameToState){this._nameToState[t].destroy()}this._nameToState=Pt(!0)}},{key:"play",value:function(t){if(this._hasBeenPlayed=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)}},{key:"crossFade",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3;this._hasBeenPlayed=!0;var i=this._nameToState[t];i&&(this._crossFade.play(),this._crossFade.crossFade(i,e))}},{key:"pause",value:function(){this._crossFade.pause()}},{key:"resume",value:function(){this._crossFade.resume()}},{key:"stop",value:function(){this._crossFade.stop()}},{key:"getAnimationState",value:function(t){return this.getState(t)}},{key:"getState",value:function(t){var e=this._nameToState[t];return e&&!e.curveLoaded&&e.initialize(this.node),e||null}},{key:"createState",value:function(t,e){return e=e||t.name,this.removeState(e),this._doCreateState(t,e)}},{key:"removeState",value:function(t){var e=this._nameToState[t];e&&(e.allowLastFrameEvent(!1),e.stop(),delete this._nameToState[t])}},{key:"addClip",value:function(t,e){return Mt(this._clips,t)||this._clips.push(t),this.createState(t,e)}},{key:"removeClip",value:function(t,e){var i;for(var r in this._nameToState){var n=this._nameToState[r];if(n.clip===t){i=n;break}}if(t===this._defaultClip){if(!e)return void Nt(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!e)return void Nt(3903);i.stop()}this._clips=this._clips.filter((function(e){return e!==t})),i&&delete this._nameToState[i.name]}},{key:"on",value:function(t,i,r,n){var a=q(H(e.prototype),"on",this).call(this,t,i,r,n);return t===Jo.LASTFRAME&&this._syncAllowLastFrameEvent(),a}},{key:"once",value:function(t,i,r){var n=q(H(e.prototype),"once",this).call(this,t,i,r);return t===Jo.LASTFRAME&&this._syncAllowLastFrameEvent(),n}},{key:"off",value:function(t,i,r){q(H(e.prototype),"off",this).call(this,t,i,r),t===Jo.LASTFRAME&&this._syncDisallowLastFrameEvent()}},{key:"_createState",value:function(t,e){return new eu(t,e)}},{key:"_doCreateState",value:function(t,e){var i=this._createState(t,e);return i._setEventTarget(this),i.allowLastFrameEvent(this.hasEventListener(Jo.LASTFRAME)),this.node&&i.initialize(this.node),this._nameToState[i.name]=i,i}},{key:"_getStateByNameOrDefaultClip",value:function(t){if(!t){if(!this._defaultClip)return null;t=this._defaultClip.name}var e=this._nameToState[t];return e||null}},{key:"_removeStateOfAutomaticClip",value:function(t){for(var e in this._nameToState){var i=this._nameToState[e];ku(t,i.clip)&&(i.stop(),delete this._nameToState[e])}}},{key:"_syncAllowLastFrameEvent",value:function(){if(this.hasEventListener(Jo.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)}},{key:"_syncDisallowLastFrameEvent",value:function(){if(!this.hasEventListener(Jo.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)}},{key:"clips",get:function(){return this._clips},set:function(t){var e=this;this._crossFade&&this._crossFade.clear();for(var i,r=yt(this._clips);!(i=r()).done;){var n=i.value;n&&this._removeStateOfAutomaticClip(n)}for(var a,s=yt(t);!(a=s()).done;){var o=a.value;o&&this.createState(o)}var u=t.find((function(t){return ku(t,e._defaultClip)}));this._defaultClip=u||null,this._clips=t}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(t){(this._defaultClip=t,t)&&(this._clips.findIndex((function(e){return ku(e,t)}))>=0||(this._clips.push(t),this.createState(t)))}}]),e}(Ct(lt)),vu.EventType=Jo,J((du=yu).prototype,"clips",[ou,uu],Object.getOwnPropertyDescriptor(du.prototype,"clips"),du.prototype),J(du.prototype,"defaultClip",[hu,lu],Object.getOwnPropertyDescriptor(du.prototype,"defaultClip"),du.prototype),_u=J(du.prototype,"playOnLoad",[nt,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mu=J(du.prototype,"_clips",[pu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gu=J(du.prototype,"_defaultClip",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fu=du))||fu)||fu)||fu)||fu)||fu));function ku(t,e){return t===e||!(!t||!e||t.name!==e.name&&t._uuid!==e._uuid)}var Su,Tu,xu,Au,Iu,Eu,Cu,Pu,Mu,Nu,Ou,Ru,Du,zu,Bu,Fu,Lu,ju,Vu,Wu,Uu=new c,Hu=new c,Gu=[],qu=t("K",function(t){function e(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return V(this,e),(i=U(this,H(e).call(this,t,r)))._frames=1,i._bakedDuration=0,i._animInfo=null,i._sockets=[],i._animInfoMgr=void 0,i._comps=[],i._parent=null,i._curvesInited=!1,i._animInfoMgr=G.director.root.dataPoolManager.jointAnimationInfo,i}return W(e,t),j(e,[{key:"initialize",value:function(t){if(!this._curveLoaded){this._comps.length=0;for(var i=t.getComponentsInChildren(ta),r=0;r<i.length;++r){var n=i[r];n.skinningRoot===t&&this._comps.push(n)}this._parent=t.getComponent("cc.SkeletalAnimation");var a=this._parent.useBakedAnimation;q(H(e.prototype),"initialize",this).call(this,t,a?Gu:void 0),this._curvesInited=!a;var s=Qe.getOrExtract(this.clip).info;this._frames=s.frames-1,this._animInfo=this._animInfoMgr.getData(t.uuid),this._bakedDuration=this._frames/s.sample}}},{key:"onPlay",value:function(){if(q(H(e.prototype),"onPlay",this).call(this),this._parent.useBakedAnimation){this._sampleCurves=this._sampleCurvesBaked,this.duration=this._bakedDuration,this._animInfoMgr.switchClip(this._animInfo,this._clip);for(var t=0;t<this._comps.length;++t)this._comps[t].uploadAnimation(this.clip)}else this._sampleCurves=q(H(e.prototype),"_sampleCurves",this),this.duration=this._clip.duration,this._curvesInited||(this._curveLoaded=!1,q(H(e.prototype),"initialize",this).call(this,this._targetNode),this._curvesInited=!0)}},{key:"rebuildSocketCurves",value:function(t){if(this._sockets.length=0,!this._targetNode)return null;for(var e=this._targetNode,i=0;i<t.length;++i){var r=t[i],a=e.getChildByPath(r.path);if(r.target){for(var s=Qe.getOrExtract(this.clip),o=r.path,h=s.data[o],l=a,p=void 0;!h;){var f=o.lastIndexOf("/");if(o=o.substring(0,f),h=s.data[o],l&&(p||(p=c.identity(Hu)),c.fromRTS(Uu,l.rotation,l.position,l.scale),c.multiply(p,Uu,p),l=l.parent),f<0)break}for(var d=h&&h.worldMatrix.values,_=s.info.frames,m=[],g=0;g<_;g++){var v=void 0;v=d&&p?c.multiply(Uu,d[g],p):d?d[g]:p||c.IDENTITY;var y={pos:new n,rot:new u,scale:new n};c.toRTS(v,y.rot,y.pos,y.scale),m.push(y)}this._sockets.push({target:r.target,frames:m})}}}},{key:"_sampleCurvesBaked",value:function(t){var e=this._animInfo,i=t*this._frames+.5|0;if(i!==e.data[0]){e.data[0]=i,e.dirty=!0;for(var r=0;r<this._sockets.length;++r){var n=this._sockets[r],a=n.target,s=n.frames[i],o=s.pos,u=s.rot,h=s.scale;a.setRTS(u,o,h)}}}}]),e}(eu)),Ku=t("N",(Su=K("cc.SkeletalAnimation.Socket"),Tu=X(de),Su((Iu=J((Au=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;V(this,t),tt(this,"path",Iu,this),tt(this,"target",Eu,this),this.path=e,this.target=i}).prototype,"path",[nt,it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Eu=J(Au.prototype,"target",[Tu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xu=Au))||xu));mt.setClassAlias(Ku,"cc.SkeletalAnimationComponent.Socket");var Xu=new c,Yu=new c;function Ju(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=0;r<t.children.length;r++){var n=t.children[r];if(n){var a=e?"".concat(e,"/").concat(n.name):n.name;i.push(a),Ju(n,a,i)}}return i}var Qu,Zu,$u,th=t("w",(Cu=K("cc.SkeletalAnimation"),Pu=Q(),Mu=_e(99),Nu=Z(),Ou=X([Ku]),Ru=$(),Du=$(),zu=X([Ku]),Cu(Bu=Pu(Bu=Mu(Bu=Y(Bu=Nu((Wu=Vu=function(t){function e(){var t,i;V(this,e);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return i=U(this,(t=H(e)).call.apply(t,[this].concat(n))),tt(i,"_useBakedAnimation",Lu,et(i)),tt(i,"_sockets",ju,et(i)),i}return W(e,t),j(e,[{key:"onDestroy",value:function(){q(H(e.prototype),"onDestroy",this).call(this),G.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),G.director.getAnimationManager().removeSockets(this.node,this._sockets)}},{key:"start",value:function(){this.sockets=this._sockets,this.useBakedAnimation=this._useBakedAnimation,q(H(e.prototype),"start",this).call(this)}},{key:"querySockets",value:function(){var t=this._defaultClip&&Object.keys(Qe.getOrExtract(this._defaultClip).data).sort().reduce((function(t,e){return e.startsWith(t[t.length-1])||t.push(e),t}),[])||[];if(!t.length)return["please specify a valid default animation clip first"];for(var e=[],i=0;i<t.length;i++){var r=t[i],n=this.node.getChildByPath(r);n&&(e.push(r),Ju(n,r,e))}return e}},{key:"rebuildSocketAnimations",value:function(){for(var t,e=yt(this._sockets);!(t=e()).done;){var i=t.value,r=this.node.getChildByPath(i.path),n=i.target;r&&n&&(n.name="".concat(i.path.substring(i.path.lastIndexOf("/")+1)," Socket"),n.parent=this.node,Te(r,this.node,Xu),c.fromRTS(Yu,n.rotation,n.position,n.scale),c.equals(Yu,Xu)||(n.matrix=Xu))}for(var a=0,s=Object.keys(this._nameToState);a<s.length;a++){var o=s[a];this._nameToState[o].rebuildSocketCurves(this._sockets)}}},{key:"createSocket",value:function(t){var e=this._sockets.find((function(e){return e.path===t}));if(e)return e.target;if(!this.node.getChildByPath(t))return console.warn("illegal socket path"),null;var i=new de;return i.parent=this.node,this._sockets.push(new Ku(t,i)),this.rebuildSocketAnimations(),i}},{key:"_createState",value:function(t,e){return new qu(t,e)}},{key:"_doCreateState",value:function(t,i){var r=q(H(e.prototype),"_doCreateState",this).call(this,t,i);return r.rebuildSocketCurves(this._sockets),r}},{key:"sockets",get:function(){return this._sockets},set:function(t){if(!this._useBakedAnimation){var e=G.director.getAnimationManager();e.removeSockets(this.node,this._sockets),e.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}},{key:"useBakedAnimation",get:function(){return this._useBakedAnimation},set:function(t){this._useBakedAnimation=t;for(var e=this.node.getComponentsInChildren(ta),i=0;i<e.length;++i){var r=e[i];r.skinningRoot===this.node&&r.setUseBakedAnimation(this._useBakedAnimation)}this._useBakedAnimation?G.director.getAnimationManager().removeSockets(this.node,this._sockets):G.director.getAnimationManager().addSockets(this.node,this._sockets)}}]),e}(wu),Vu.Socket=Ku,J((Fu=Wu).prototype,"sockets",[Ou,Ru],Object.getOwnPropertyDescriptor(Fu.prototype,"sockets"),Fu.prototype),J(Fu.prototype,"useBakedAnimation",[Du],Object.getOwnPropertyDescriptor(Fu.prototype,"useBakedAnimation"),Fu.prototype),Lu=J(Fu.prototype,"_useBakedAnimation",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ju=J(Fu.prototype,"_sockets",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bu=Fu))||Bu)||Bu)||Bu)||Bu)||Bu));_t(wu.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var t=arguments.length<=0?void 0:arguments[0];return wu.prototype.removeState.call(this,t.name)}}]),G.AnimationComponent=wu,mt.setClassAlias(wu,"cc.AnimationComponent"),G.SkeletalAnimationComponent=th,mt.setClassAlias(th,"cc.SkeletalAnimationComponent");var eh,ih,rh,nh,ah=t("J",K(($u=Zu=function(t){function e(){var t,i;V(this,e);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(i=U(this,(t=H(e)).call.apply(t,[this].concat(n))))._anims=new Ot([]),i._delayEvents=[],i._blendStateBuffer=new Xo,i._crossFades=[],i._sockets=[],i}return W(e,t),j(e,[{key:"addCrossFade",value:function(t){this._crossFades.push(t)}},{key:"removeCrossFade",value:function(t){Et(this._crossFades,t)}},{key:"update",value:function(t){for(var e=this._delayEvents,i=this._crossFades,r=this._sockets,n=0,a=i.length;n<a;n++)i[n].update(t);var s=this._anims,o=s.array;for(s.i=0;s.i<o.length;++s.i){var u=o[s.i];u.isMotionless||u.update(t)}this._blendStateBuffer.apply();for(var h=G.director.getTotalFrames(),l=0,c=r.length;l<c;l++){var p=r[l],f=p.target,d=p.transform;f.matrix=ai(d,h)}for(var _=0,m=e.length;_<m;_++){var g=e[_];g.fn.apply(g.thisArg,g.args)}e.length=0}},{key:"destruct",value:function(){}},{key:"addAnimation",value:function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)}},{key:"removeAnimation",value:function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):bt(3907)}},{key:"pushDelayEvent",value:function(t,e,i){this._delayEvents.push({fn:t,thisArg:e,args:i})}},{key:"addSockets",value:function(t,e){for(var i=this,r=function(r){var n=e[r];if(i._sockets.find((function(t){return t.target===n.target})))return"continue";var a=t.getChildByPath(n.path),s=n.target&&a&&oi(a,t);s&&i._sockets.push({target:n.target,transform:s})},n=0;n<e.length;++n)r(n)}},{key:"removeSockets",value:function(t,e){for(var i=0;i<e.length;++i)for(var r=e[i],n=0;n<this._sockets.length;++n){var a=this._sockets[n];if(a.target===r.target){si(a.transform.node),this._sockets[n]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}}},{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(xi),Zu.ID="animation",Qu=$u))||Qu);ki.on(Si.EVENT_INIT,(function(){var t=new ah;ki.registerSystem(ah.ID,t,Ti.PRIORITY_SYSTEM)})),G.AnimationManager=ah,G.easing=co;var sh=t("H",K("cc.HierachyModifier")(eh=function(t){function e(){return V(this,e),U(this,H(e).apply(this,arguments))}return W(e,t),e}(ni))||eh);G.HierachyModifier=sh;var oh=t("o",K("cc.ComponentModifier")(ih=function(t){function e(){return V(this,e),U(this,H(e).apply(this,arguments))}return W(e,t),e}(Je))||ih);G.ComponentModifier=oh;var uh=t("p",K("cc.CurveValueAdapter")(rh=function(){function t(){V(this,t)}return j(t,[{key:"forTarget",value:function(t){return{set:function(){}}}}]),t}())||rh);G.CurveValueAdapter=uh;var hh=t("q",K("cc.UniformCurveValueAdapter")(nh=function(t){function e(){return V(this,e),U(this,H(e).apply(this,arguments))}return W(e,t),e}(ks))||nh);function lh(t){return"string"==typeof t}function ch(t){return"number"==typeof t}function ph(t,e){return t instanceof e}G.UniformCurveValueAdapter=hh,G.isPropertyModifier=lh,G.isElementModifier=ch,G.isCustomTargetModifier=ph;var fh,dh=function(){function t(e,i,r){V(this,t),this._id=void 0,this._opts=void 0,this._accumStart=void 0,this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=e,this._opts=i,this._accumStart=r}return j(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),j(t,[{key:"sample",value:function(t){this._average(this._value,t)}},{key:"human",value:function(){var t=this._opts,e=t.average,i=t.isInteger,r=e?this._averageValue:this._value;return i?Math.round(r):Math.round(100*r)/100}},{key:"alarm",value:function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}},{key:"_average",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this._opts.average){this._accumValue+=t,++this._accumSamples;var i=e;i-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=i,this._accumSamples=0)}}}]),t}(),_h=K("cc.PerfCounter")(fh=function(t){function e(t,i,r){var n;return V(this,e),(n=U(this,H(e).call(this,t,i,r)))._time=void 0,n._time=r,n}return W(e,t),j(e,[{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._time=t}},{key:"end",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._value=t-this._time,this._average(this._value)}},{key:"tick",value:function(){this.end(),this.start()}},{key:"frame",value:function(t){var e=t,i=e-this._time;this._total++,i>(this._opts.average||1e3)&&(this._value=1e3*this._total/i,this._total=0,this._time=e,this._average(this._value))}}]),e}(dh))||fh,mh={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},gh={frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:500},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},vh=23,yh=.4,bh=8,wh=256,kh=256,Sh=t("P",function(){function t(){V(this,t),this._stats=null,this.id="__Profiler__",this._showFPS=!1,this._rootNode=null,this._device=null,this._canvas=null,this._ctx=null,this._texture=null,this._region=new xe,this._canvasArr=[],this._regionArr=[this._region],this.digitsData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=kh/(Object.keys(gh).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvasArr.push(this._canvas)}return j(t,[{key:"isShowingStats",value:function(){return this._showFPS}},{key:"hideStats",value:function(){this._showFPS&&(this._rootNode&&(this._rootNode.active=!1),G.game.off(G.Game.EVENT_RESTART,this.generateNode,this),G.director.off(G.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),G.director.off(G.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),G.director.off(G.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),G.director.off(G.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),G.director.off(G.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),G.director.off(G.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!1)}},{key:"showStats",value:function(){this._showFPS||(this._device||(this._device=G.director.root.device),this.generateCanvas(),this.generateStats(),G.game.once(G.Game.EVENT_ENGINE_INITED,this.generateNode,this),G.game.on(G.Game.EVENT_RESTART,this.generateNode,this),this._rootNode&&(this._rootNode.active=!0),G.director.on(G.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),G.director.on(G.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),G.director.on(G.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),G.director.on(G.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),G.director.on(G.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),G.director.on(G.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!0,this._canvasDone=!0,this._statsDone=!0)}},{key:"generateCanvas",value:function(){if(!this._canvasDone){var t=wh,e=kh;this._ctx&&this._canvas&&(this._canvas.width=t,this._canvas.height=e,this._canvas.style.width="".concat(this._canvas.width),this._canvas.style.height="".concat(this._canvas.height),this._ctx.font="".concat(vh,"px Arial"),this._ctx.textBaseline="top",this._ctx.fillStyle="#fff",this._texture=this._device.createTexture({type:ui.TEX2D,usage:hi.SAMPLED|hi.TRANSFER_DST,format:ye.RGBA8,width:t,height:e}),this._region.texExtent.width=t,this._region.texExtent.height=e)}}},{key:"generateStats",value:function(){if(!this._statsDone&&this._ctx&&this._canvas){this._stats=null;var t=performance.now();this._ctx.textAlign="left";var e=0;for(var i in gh){var r=gh[i];this._ctx.fillText(r.desc,0,e*this._lineHeight),r.counter=new _h(i,r,t),e++}this._totalLines=e,this._wordHeight=this._totalLines*this._lineHeight/this._canvas.height;for(var n=0;n<"0123456789. ".length;++n){var a=this._ctx.measureText("0123456789. "[n]).width;this._eachNumWidth=Math.max(this._eachNumWidth,a)}for(var s=0;s<"0123456789. ".length;++s)this._ctx.fillText("0123456789. "[s],s*this._eachNumWidth,this._totalLines*this._lineHeight);this._eachNumWidth/=this._canvas.width,this._stats=gh,this._canvasArr[0]=this._canvas,this._device.copyTexImagesToTexture(this._canvasArr,this._texture,this._regionArr)}}},{key:"generateNode",value:function(){if(!this._rootNode||!this._rootNode.isValid){this._rootNode=new de("PROFILER_NODE"),G.game.addPersistRootNode(this._rootNode);var t=new de("Profiler_Camera");t.setPosition(0,0,1.5),t.parent=this._rootNode;var e=t.addComponent("cc.Camera");e.projection=_a.ProjectionType.ORTHO,e.near=1,e.far=2,e.orthoHeight=this._device.height,e.visibility=Be.BitMask.PROFILER,e.clearFlags=ze.NONE,e.priority=4294967295,e.flows=["UIFlow"];var i=new de("Profiler_Root");i.parent=this._rootNode;for(var r=yh,n=r/this._totalLines,a=r/this._wordHeight,o=n/vh,u=this._eachNumWidth*this._canvas.width*o,h=[0,r,0,a,r,0,a,0,0,0,0,0],l=[0,2,1,0,3,2],c=[0,0,-1,0,1,0,-1,0,1,this._wordHeight,-1,0,0,this._wordHeight,-1,0],p=0,f=0;f<this._totalLines;f++)for(var d=0;d<bh;d++){h.push(a+d*u,r-f*n,0),h.push(a+(d+1)*u,r-f*n,0),h.push(a+(d+1)*u,r-(f+1)*n,0),h.push(a+d*u,r-(f+1)*n,0),p=4*(f*bh+d+1),l.push(0+p,2+p,1+p,0+p,3+p,2+p);var _=f*bh+d,m=Math.floor(_/4),g=_-4*m;c.push(0,this._wordHeight,m,g),c.push(this._eachNumWidth,this._wordHeight,m,g),c.push(this._eachNumWidth,1,m,g),c.push(0,1,m,g)}for(var v=this._device.screenSpaceSignY,y=1;y<h.length;y+=3)h[y]*=v;var b=i.addComponent(ge);b.mesh=se({positions:h,indices:l,colors:c});var w=new ke;w.initialize({effectName:"util/profiler"}),w.setProperty("offset",new s(-.9,-.9*v,this._eachNumWidth,0));var k=this.pass=w.passes[0],S=k.getBinding("mainTexture"),T=k.getBinding("digits");k.bindTexture(S,this._texture),this.digitsData=k.blocks[T],b.material=w,b.node.layer=Be.Enum.PROFILER,this._inited=!0}}},{key:"beforeUpdate",value:function(){if(this._stats){var t=performance.now();this._stats.frame.counter.end(t),this._stats.frame.counter.start(t),this._stats.logic.counter.start(t)}}},{key:"afterUpdate",value:function(){if(this._stats){var t=performance.now();G.director.isPaused()?this._stats.frame.counter.start(t):this._stats.logic.counter.end(t)}}},{key:"beforePhysics",value:function(){if(this._stats){var t=performance.now();this._stats.physics.counter.start(t)}}},{key:"afterPhysics",value:function(){if(this._stats){var t=performance.now();this._stats.physics.counter.end(t)}}},{key:"beforeDraw",value:function(){if(this._stats){var t=performance.now();this._stats.render.counter.start(t)}}},{key:"afterDraw",value:function(){if(this._stats&&this._inited){var t=performance.now();if(this._stats.fps.counter.frame(t),this._stats.render.counter.end(t),!(t-this.lastTime<500)){this.lastTime=t;var e=this._device;this._stats.draws.counter.value=e.numDrawCalls,this._stats.instances.counter.value=e.numInstances,this._stats.bufferMemory.counter.value=e.memoryStatus.bufferSize/1048576,this._stats.textureMemory.counter.value=e.memoryStatus.textureSize/1048576,this._stats.tricount.counter.value=e.numTris;var i=0,r=this.digitsData;for(var n in this._stats){var a=this._stats[n];a.counter.sample(t);for(var s=a.counter.human().toString(),o=bh-1;o>=0;o--){var u=i*bh+o,h=s[s.length-(bh-o)],l=mh[h];void 0===l&&(l=11),r[u]=l}i++}this.pass._rootBufferDirty=!0}}}}]),t}()),Th=t("O",new Sh);G.profiler=Th;var xh=function(){function t(){V(this,t),this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return j(t,[{key:"main",value:function(t){if(null==t)return console.error("RENDER ROOT IS NULL.");if(window._CCSettings&&window._CCSettings.splashScreen?(this.setting=window._CCSettings.splashScreen,this.setting.totalTime=null!=this.setting.totalTime?this.setting.totalTime:3e3,this.setting.base64src=this.setting.base64src||"",this.setting.effect=this.setting.effect||"FADE-INOUT",this.setting.clearColor=this.setting.clearColor||{r:.88,g:.88,b:.88,a:1},this.setting.displayRatio=null!=this.setting.displayRatio?this.setting.displayRatio:.4,this.setting.displayWatermark=null==this.setting.displayWatermark||this.setting.displayWatermark):this.setting={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:{r:.88,g:.88,b:.88,a:1},displayRatio:.4,displayWatermark:!0},""===this.setting.base64src||this.setting.totalTime<=0)return this.callBack&&this.callBack(),this.callBack=null,this.setting=null,void(this._directCall=!0);G.view.enableRetina(!0);var e=window._CCSettings.designResolution;e?G.view.setDesignResolutionSize(e.width,e.height,e.policy):G.view.setDesignResolutionSize(960,640,4),this.root=t,this.device=t.device,G.game.once(G.Game.EVENT_GAME_INITED,(function(){G.director._lateUpdate=performance.now()}),G.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.clearColors=[this.setting.clearColor],this.screenWidth=this.device.width,this.screenHeight=this.device.height,this.image=new Image,this.image.onload=this.init.bind(this),this.image.src=this.setting.base64src}},{key:"setOnFinish",value:function(e){if(this._directCall&&e)return delete t._ins,e();this.callBack=e}},{key:"_tryToStart",value:function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide())}},{key:"init",value:function(){var t=this;this.initCMD(),this.initIA(),this.initPSO(),this.setting.displayWatermark&&this.initText();this.handle=requestAnimationFrame((function e(i){if(!t.cancelAnimate){t.startTime<0&&(t.startTime=i);var r=i-t.startTime,n=Bs(T(r/t.setting.totalTime));"NONE"===t.setting.effect&&(n=1),t.material.setProperty("u_precent",n),t.material.passes[0].update(),t.setting.displayWatermark&&t.textMaterial&&(t.textMaterial.setProperty("u_precent",n),t.textMaterial.passes[0].update()),t.frame(i),r>t.setting.totalTime&&(t.splashFinish=!0),requestAnimationFrame(e)}}))}},{key:"hide",value:function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))}},{key:"frame",value:function(t){if(!this.cancelAnimate){var e=this.device;e.acquire();var i=this.cmdBuff,r=this.framebuffer,n=this.renderArea;i.begin(),i.beginRenderPass(r.renderPass,r,n,this.clearColors,1,0);var a=this.material.passes[0].handle,s=li.getOrCreatePipelineState(e,a,this.shader,r.renderPass,this.assmebler);if(i.bindPipelineState(s),i.bindDescriptorSet(ci.MATERIAL,pi.get(fi.get(a,di.DESCRIPTOR_SET))),i.bindInputAssembler(this.assmebler),i.draw(this.assmebler),this.setting.displayWatermark&&this.textShader&&this.textAssmebler){var o=this.textMaterial.passes[0].handle,u=li.getOrCreatePipelineState(e,o,this.textShader,r.renderPass,this.textAssmebler);i.bindPipelineState(u),i.bindDescriptorSet(ci.MATERIAL,pi.get(fi.get(o,di.DESCRIPTOR_SET))),i.bindInputAssembler(this.textAssmebler),i.draw(this.textAssmebler)}i.endRenderPass(),i.end(),e.queue.submit([i]),e.present()}}},{key:"initText",value:function(){this.textImg=document.createElement("canvas"),this.textImg.width=330,this.textImg.height=30,this.textImg.style.width="".concat(this.textImg.width),this.textImg.style.height="".concat(this.textImg.height);var t=this.textImg.getContext("2d");t.font="".concat(18,"px Arial"),t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var e="Powered by Cocos Creator 3D",i=t.measureText(e);t.fillText(e,(330-i.width)/2,6),this.textRegion=new xe,this.textRegion.texExtent.width=this.textImg.width,this.textRegion.texExtent.height=this.textImg.height,this.textRegion.texExtent.depth=1,this.textTexture=this.device.createTexture({type:ui.TEX2D,usage:hi.SAMPLED|hi.TRANSFER_DST,format:ye.RGBA8,width:this.textImg.width,height:this.textImg.height}),this.device.copyTexImagesToTexture([this.textImg],this.textTexture,[this.textRegion]),this.textMaterial=new ke,this.textMaterial.initialize({effectName:"util/splash-screen"});var r=this.textMaterial.passes[0],n=r.getBinding("mainTexture");r.bindTexture(n,this.textTexture),this.textShader=_i.get(r.getShaderVariant()),pi.get(fi.get(r.handle,di.DESCRIPTOR_SET)).update();var a=4*Float32Array.BYTES_PER_ELEMENT,s=4*a;this.textVB=this.device.createBuffer({usage:Yt.VERTEX|Yt.TRANSFER_DST,memUsage:Jt.HOST|Jt.DEVICE,size:s,stride:a});var o=new Float32Array(16),u=-this.textImg.width/2,h=-this.textImg.height/2;h=this.screenWidth<this.screenHeight?(u=-this.screenWidth/2*.5)/(this.textImg.width/this.textImg.height):(u=-this.screenHeight/2*.5)/(this.textImg.width/this.textImg.height);var l=0;o[l++]=u,o[l++]=h,o[l++]=0,o[l++]=1,o[l++]=-u,o[l++]=h,o[l++]=1,o[l++]=1,o[l++]=u,o[l++]=-h,o[l++]=0,o[l++]=0,o[l++]=-u,o[l++]=-h,o[l++]=1,o[l++]=0;for(var c=0;c<o.length;c+=4)o[c]=o[c]+this.screenWidth/2,o[c+1]=o[c+1]+.1*this.screenHeight;for(var p=this.device.screenSpaceSignY,f=0;f<o.length;f+=4)o[f]=o[f]/this.screenWidth*2-1,o[f+1]=(o[f+1]/this.screenHeight*2-1)*p;this.textVB.update(o);var d=Uint16Array.BYTES_PER_ELEMENT,_=6*d;this.textIB=this.device.createBuffer({usage:Yt.INDEX|Yt.TRANSFER_DST,memUsage:Jt.HOST|Jt.DEVICE,size:_,stride:d});var m=new Uint16Array(6);m[0]=0,m[1]=1,m[2]=2,m[3]=1,m[4]=3,m[5]=2,this.textIB.update(m);var g=[{name:"a_position",format:ye.RG32F},{name:"a_texCoord",format:ye.RG32F}];this.textAssmebler=this.device.createInputAssembler({attributes:g,vertexBuffers:[this.textVB],indexBuffer:this.textIB})}},{key:"initCMD",value:function(){var t=this.device;this.renderArea={x:0,y:0,width:t.width,height:t.height},this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=t.createCommandBuffer({queue:t.queue,type:mi.PRIMARY})}},{key:"initIA",value:function(){var t=this.device,e=4*Float32Array.BYTES_PER_ELEMENT,i=4*e;this.vertexBuffers=t.createBuffer({usage:Yt.VERTEX|Yt.TRANSFER_DST,memUsage:Jt.HOST|Jt.DEVICE,size:i,stride:e});var r=new Float32Array(16),n=-this.image.width/2,a=-this.image.height/2;a=this.screenWidth<this.screenHeight?(n=-this.screenWidth/2*this.setting.displayRatio)/(this.image.width/this.image.height):(n=-this.screenHeight/2*this.setting.displayRatio)/(this.image.width/this.image.height);var s=0;r[s++]=n,r[s++]=a,r[s++]=0,r[s++]=1,r[s++]=-n,r[s++]=a,r[s++]=1,r[s++]=1,r[s++]=n,r[s++]=-a,r[s++]=0,r[s++]=0,r[s++]=-n,r[s++]=-a,r[s++]=1,r[s++]=0;for(var o=0;o<r.length;o+=4)r[o]=r[o]+this.screenWidth/2,r[o+1]=r[o+1]+this.screenHeight/2;for(var u=t.screenSpaceSignY,h=0;h<r.length;h+=4)r[h]=r[h]/this.screenWidth*2-1,r[h+1]=(r[h+1]/this.screenHeight*2-1)*u;this.vertexBuffers.update(r);var l=Uint16Array.BYTES_PER_ELEMENT,c=6*l;this.indicesBuffers=t.createBuffer({usage:Yt.INDEX|Yt.TRANSFER_DST,memUsage:Jt.HOST|Jt.DEVICE,size:c,stride:l});var p=new Uint16Array(6);p[0]=0,p[1]=1,p[2]=2,p[3]=1,p[4]=3,p[5]=2,this.indicesBuffers.update(p);var f=[{name:"a_position",format:ye.RG32F},{name:"a_texCoord",format:ye.RG32F}];this.assmebler=t.createInputAssembler({attributes:f,vertexBuffers:[this.vertexBuffers],indexBuffer:this.indicesBuffers})}},{key:"initPSO",value:function(){var t=this.device;this.material=new ke,this.material.initialize({effectName:"util/splash-screen"}),this.sampler=t.createSampler({addressU:gi.CLAMP,addressV:gi.CLAMP}),this.texture=t.createTexture({type:ui.TEX2D,usage:hi.SAMPLED|hi.TRANSFER_DST,format:ye.RGBA8,width:this.image.width,height:this.image.height});var e=this.material.passes[0],i=e.getBinding("mainTexture");e.bindTexture(i,this.texture),this.shader=_i.get(e.getShaderVariant());var r=pi.get(fi.get(e.handle,di.DESCRIPTOR_SET));r.bindSampler(i,this.sampler),r.update(),this.region=new xe,this.region.texExtent.width=this.image.width,this.region.texExtent.height=this.image.height,this.region.texExtent.depth=1,t.copyTexImagesToTexture([this.image],this.texture,[this.region])}},{key:"destroy",value:function(){this.callBack=null,this.clearColors=null,this.device=null,this.image=null,this.framebuffer=null,this.renderArea=null,this.region=null,this.cmdBuff.destroy(),this.cmdBuff=null,this.shader=null,this.material.destroy(),this.material=null,this.texture.destroy(),this.texture=null,this.assmebler.destroy(),this.assmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.setting.displayWatermark&&this.textImg&&(this.textImg=null,this.textRegion=null,this.textShader=null,this.textMaterial.destroy(),this.textMaterial=null,this.textTexture.destroy(),this.textTexture=null,this.textAssmebler.destroy(),this.textAssmebler=null,this.textVB.destroy(),this.textVB=null,this.textIB.destroy(),this.textIB=null),this.setting=null,delete t._ins}},{key:"splashFinish",set:function(t){this._splashFinish=t,this._tryToStart()}},{key:"loadFinish",set:function(t){this._loadFinish=t,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();xh._ins=void 0,G.internal.SplashScreen=xh;var Ah={};_t(Ah,"vmath",[{name:"vec2",newName:"Vec2",target:Ai,targetName:"math"},{name:"vec3",newName:"Vec3",target:Ai,targetName:"math"},{name:"vec4",newName:"Vec4",target:Ai,targetName:"math"},{name:"quat",newName:"Quat",target:Ai,targetName:"math"},{name:"mat3",newName:"Mat3",target:Ai,targetName:"math"},{name:"mat4",newName:"Mat4",target:Ai,targetName:"math"},{name:"color4",newName:"Color",target:Ai,targetName:"math"},{name:"rect",newName:"Rect",target:Ai,targetName:"math"},{name:"approx",newName:"approx",target:Ai,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:Ai,targetName:"math"},{name:"equals",newName:"equals",target:Ai,targetName:"math"},{name:"clamp",newName:"clamp",target:Ai,targetName:"math"},{name:"clamp01",newName:"clamp01",target:Ai,targetName:"math"},{name:"lerp",newName:"lerp",target:Ai,targetName:"math"},{name:"toRadian",newName:"toRadian",target:Ai,targetName:"math"},{name:"toDegree",newName:"toDegree",target:Ai,targetName:"math"},{name:"random",newName:"random",target:Ai,targetName:"math"},{name:"randomRange",newName:"randomRange",target:Ai,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:Ai,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:Ai,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:Ai,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:Ai,targetName:"math"},{name:"repeat",newName:"repeat",target:Ai,targetName:"math"},{name:"pingPong",newName:"pingPong",target:Ai,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:Ai,targetName:"math"}]),G.vmath=Ah,_t(Ti.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:Ti,targetName:"Scheduler"}]),_t(vi.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:vi,targetName:"EventTouch"}]),_t(G,"cc",[{name:"GFXDynamicState",newName:"GFXDynamicStateFlagBit"},{name:"GFXBindingType",newName:"GFXDescriptorType"},{name:"GFXBindingLayout",newName:"GFXDescriptorSet"}]),dt(yi.prototype,"GFXCommandBuffer.prototype",[{name:"bindBindingLayout",suggest:"Use `bindDescriptorSet` instead"}]),_t(bi.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),dt(bi.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),G.math=Ai,G.geometry=Ei}}}));
