System.register(["./deprecated-fd5a8e75.js","./deprecated-9a4df5e2.js"],(function(e){"use strict";var t,i,n,r,a,s,o,l,h,u,_,c,d,p,y,v,f,g,m,E,S,R,b,w,A,D,T,F,O,C,x,M,k,z,I,L,P,N,U,H,B,W,V,G,Y,X,j,q,K,Z,Q,J,$,ee;return{setters:[function(e){t=e.l,i=e.b,n=e.j,r=e.T,a=e.d,s=e.e,o=e.f,l=e.i,h=e.W,u=e.H,_=e.y,c=e.v,d=e.bB,p=e.bC,y=e.bD,v=e.az,f=e.aO,g=e.ao,m=e.E,E=e.c,S=e.t,R=e.b2,b=e._,w=e.b3,A=e.a,D=e.g,T=e.D,F=e.s,O=e.Y,C=e.F,x=e.h,M=e.m,k=e.r,z=e.k,I=e.C},function(e){L=e.bg,P=e.d8,N=e.d9,U=e.b9,H=e.bF,B=e.da,W=e.db,V=e.dc,G=e.aq,Y=e.dd,X=e.d3,j=e.d4,q=e.aT,K=e.b7,Z=e.de,Q=e.df,J=e.dg,$=e.aX,ee=e.cX}],execute:function(){e("I",void 0);var te=e("c",{topLeft:t.v2(0,0),topRight:t.v2(0,0),top:t.v2(0,0),bottomLeft:t.v2(0,0),bottomRight:t.v2(0,0),bottom:t.v2(0,0),center:t.v2(0,0),left:t.v2(0,0),right:t.v2(0,0),width:0,height:0,init:function(e){var t=this.width=e.width,i=this.height=e.height,n=e.x,r=e.y,a=r+i,s=n+t;this.topLeft.x=n,this.topLeft.y=a,this.topRight.x=s,this.topRight.y=a,this.top.x=n+t/2,this.top.y=a,this.bottomLeft.x=n,this.bottomLeft.y=r,this.bottomRight.x=s,this.bottomRight.y=r,this.bottom.x=n+t/2,this.bottom.y=r,this.center.x=n+t/2,this.center.y=r+i/2,this.left.x=n,this.left.y=r+i/2,this.right.x=s,this.right.y=r+i/2}});t.visibleRect=te;var ie=new(function(){function e(){a(this,e),this.html=void 0,this.meta={width:"device-width"},this.adaptationType=t.sys.browserType}return n(e,[{key:"init",value:function(){this.html=document.getElementsByTagName("html")[0]}},{key:"availWidth",value:function(e){return t.sys.isMobile||!e||e===this.html?window.innerWidth:e.clientWidth}},{key:"availHeight",value:function(e){return t.sys.isMobile||!e||e===this.html?window.innerHeight:e.clientHeight}}]),e}());switch(t.sys.os===t.sys.OS_IOS&&(ie.adaptationType=t.sys.BROWSER_TYPE_SAFARI),ie.adaptationType){case t.sys.BROWSER_TYPE_SAFARI:ie.meta["minimal-ui"]="true";case t.sys.BROWSER_TYPE_SOUGOU:case t.sys.BROWSER_TYPE_UC:ie.availWidth=function(e){return e.clientWidth},ie.availHeight=function(e){return e.clientHeight}}var ne=e("V",function(e){function v(){var e;a(this,v),(e=s(this,o(v).call(this)))._resizeWithBrowserSize=void 0,e._designResolutionSize=void 0,e._originalDesignResolutionSize=void 0,e._frameSize=void 0,e._scaleX=void 0,e._scaleY=void 0,e._viewportRect=void 0,e._visibleRect=void 0,e._autoFullScreen=void 0,e._devicePixelRatio=void 0,e._maxPixelRatio=void 0,e._retinaEnabled=void 0,e._resizeCallback=void 0,e._resizing=void 0,e._orientationChanging=void 0,e._isRotated=void 0,e._orientation=void 0,e._isAdjustViewport=void 0,e._antiAliasEnabled=void 0,e._resolutionPolicy=void 0,e._rpExactFit=void 0,e._rpShowAll=void 0,e._rpNoBorder=void 0,e._rpFixedHeight=void 0,e._rpFixedWidth=void 0;l(e);var i=re,n=ae;return e._frameSize=new r(0,0),e._designResolutionSize=new r(0,0),e._originalDesignResolutionSize=new r(0,0),e._scaleX=1,e._scaleY=1,e._viewportRect=new h(0,0,0,0),e._visibleRect=new h(0,0,0,0),e._autoFullScreen=!1,e._devicePixelRatio=1,e._maxPixelRatio=2,e._retinaEnabled=!1,e._resizeCallback=null,e._resizing=!1,e._resizeWithBrowserSize=!1,e._orientationChanging=!0,e._isRotated=!1,e._orientation=t.macro.ORIENTATION_AUTO,e._isAdjustViewport=!0,e._antiAliasEnabled=!1,e._rpExactFit=new se(i.EQUAL_TO_FRAME,n.EXACT_FIT),e._rpShowAll=new se(i.EQUAL_TO_FRAME,n.SHOW_ALL),e._rpNoBorder=new se(i.EQUAL_TO_FRAME,n.NO_BORDER),e._rpFixedHeight=new se(i.EQUAL_TO_FRAME,n.FIXED_HEIGHT),e._rpFixedWidth=new se(i.EQUAL_TO_FRAME,n.FIXED_WIDTH),e._resolutionPolicy=e._rpShowAll,t.game.once(t.Game.EVENT_ENGINE_INITED,e.init,l(e)),e}return i(v,e),n(v,[{key:"init",value:function(){ie.init(),this._initFrameSize(),this.enableAntiAlias(!0);var e=t.game.canvas.width,i=t.game.canvas.height;this._designResolutionSize.width=e,this._designResolutionSize.height=i,this._originalDesignResolutionSize.width=e,this._originalDesignResolutionSize.height=i,this._viewportRect.width=e,this._viewportRect.height=i,this._visibleRect.width=e,this._visibleRect.height=i,t.winSize.width=this._visibleRect.width,t.winSize.height=this._visibleRect.height,t.visibleRect&&t.visibleRect.init(this._visibleRect)}},{key:"resizeWithBrowserSize",value:function(e){e?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))}},{key:"setResizeCallback",value:function(e){"function"!=typeof e&&null!=e||(this._resizeCallback=e)}},{key:"setOrientation",value:function(e){(e&=t.macro.ORIENTATION_AUTO)&&this._orientation!==e&&(this._orientation=e)}},{key:"adjustViewportMeta",value:function(e){this._isAdjustViewport=e}},{key:"enableRetina",value:function(e){this._retinaEnabled=!!e}},{key:"isRetinaEnabled",value:function(){return this._retinaEnabled}},{key:"enableAntiAlias",value:function(e){if(this._antiAliasEnabled!==e)if(this._antiAliasEnabled=e,t.game.renderType===t.Game.RENDER_TYPE_WEBGL){var i=t.loader._cache;for(var n in i){var r=i[n],a=r&&r.content instanceof t.Texture2D?r.content:null;if(a){var s=t.Texture2D.Filter;e?a.setFilters(s.LINEAR,s.LINEAR):a.setFilters(s.NEAREST,s.NEAREST)}}}else if(t.game.renderType===t.Game.RENDER_TYPE_CANVAS){var o=t.game.canvas.getContext("2d");o.imageSmoothingEnabled=e,o.mozImageSmoothingEnabled=e}}},{key:"isAntiAliasEnabled",value:function(){return this._antiAliasEnabled}},{key:"enableAutoFullScreen",value:function(e){e&&e!==this._autoFullScreen&&t.sys.isMobile&&t.sys.browserType!==t.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,t.screen.autoFullScreen(t.game.frame)):this._autoFullScreen=!1}},{key:"isAutoFullScreenEnabled",value:function(){return this._autoFullScreen}},{key:"setCanvasSize",value:function(e,i){var n=t.game.canvas,r=t.game.container;this._devicePixelRatio=window.devicePixelRatio,n.width=e*this._devicePixelRatio,n.height=i*this._devicePixelRatio,n.style.width=e+"px",n.style.height=i+"px",r.style.width=e+"px",r.style.height=i+"px",this._resizeEvent()}},{key:"getCanvasSize",value:function(){return new r(t.game.canvas.width,t.game.canvas.height)}},{key:"getFrameSize",value:function(){return new r(this._frameSize.width,this._frameSize.height)}},{key:"setFrameSize",value:function(e,i){this._frameSize.width=e,this._frameSize.height=i,t.frame.style.width=e+"px",t.frame.style.height=i+"px",this._resizeEvent()}},{key:"getVisibleSize",value:function(){return new r(this._visibleRect.width,this._visibleRect.height)}},{key:"getVisibleSizeInPixel",value:function(){return new r(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)}},{key:"getVisibleOrigin",value:function(){return new u(this._visibleRect.x,this._visibleRect.y)}},{key:"getVisibleOriginInPixel",value:function(){return new u(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)}},{key:"getResolutionPolicy",value:function(){return this._resolutionPolicy}},{key:"setResolutionPolicy",value:function(e){var t=this;if(e instanceof se)t._resolutionPolicy=e;else{var i=se;e===i.EXACT_FIT&&(t._resolutionPolicy=t._rpExactFit),e===i.SHOW_ALL&&(t._resolutionPolicy=t._rpShowAll),e===i.NO_BORDER&&(t._resolutionPolicy=t._rpNoBorder),e===i.FIXED_HEIGHT&&(t._resolutionPolicy=t._rpFixedHeight),e===i.FIXED_WIDTH&&(t._resolutionPolicy=t._rpFixedWidth)}}},{key:"setDesignResolutionSize",value:function(e,i,n){if(e>0||i>0){this.setResolutionPolicy(n);var r=this._resolutionPolicy;if(r&&r.preApply(this),t.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),r){this._originalDesignResolutionSize.width=this._designResolutionSize.width=e,this._originalDesignResolutionSize.height=this._designResolutionSize.height=i;var a=r.apply(this,this._designResolutionSize);if(a.scale&&2===a.scale.length&&(this._scaleX=a.scale[0],this._scaleY=a.scale[1]),a.viewport){var s=this._viewportRect,o=this._visibleRect,l=a.viewport;s.x=l.x,s.y=l.y,s.width=l.width,s.height=l.height,o.x=0,o.y=0,o.width=l.width/this._scaleX,o.height=l.height/this._scaleY}r.postApply(this),t.winSize.width=this._visibleRect.width,t.winSize.height=this._visibleRect.height,te&&te.init(this._visibleRect),this.emit("design-resolution-changed")}else c(2201)}else _(2200)}},{key:"getDesignResolutionSize",value:function(){return new r(this._designResolutionSize.width,this._designResolutionSize.height)}},{key:"setRealPixelResolution",value:function(e,t,i){this._setViewportMeta({width:e},!0),document.documentElement.style.width=e+"px",document.body.style.width=e+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(e,t,i)}},{key:"getViewportRect",value:function(){return this._viewportRect}},{key:"getScaleX",value:function(){return this._scaleX}},{key:"getScaleY",value:function(){return this._scaleY}},{key:"getDevicePixelRatio",value:function(){return this._devicePixelRatio}},{key:"convertToLocationInView",value:function(e,i,n,r){var a=r||new u,s=this._devicePixelRatio*(e-n.left),o=this._devicePixelRatio*(n.top+n.height-i);return this._isRotated?(a.x=t.game.canvas.width-o,a.y=s):(a.x=s,a.y=o),a}},{key:"_convertPointWithScale",value:function(e){var t=this._viewportRect;e.x=(e.x-t.x)/this._scaleX,e.y=(e.y-t.y)/this._scaleY}},{key:"_resizeEvent",value:function(){var e=t.view,i=e._frameSize.width,n=e._frameSize.height,r=e._isRotated;if(t.sys.isMobile){var a=t.game.container.style,s=a.margin;a.margin="0",a.display="none",e._initFrameSize(),a.margin=s,a.display="block"}else e._initFrameSize();if(e._orientationChanging||e._isRotated!==r||e._frameSize.width!==i||e._frameSize.height!==n){var o=e._originalDesignResolutionSize.width,l=e._originalDesignResolutionSize.height;e._resizing=!0,o>0&&e.setDesignResolutionSize(o,l,e._resolutionPolicy),e._resizing=!1,e.emit("canvas-resize"),e._resizeCallback&&e._resizeCallback.call()}}},{key:"_orientationChange",value:function(){t.view._orientationChanging=!0,t.view._resizeEvent()}},{key:"_initFrameSize",value:function(){var e=this._frameSize,i=ie.availWidth(t.game.frame),n=ie.availHeight(t.game.frame),r=i>=n;!t.sys.isMobile||r&&this._orientation&t.macro.ORIENTATION_LANDSCAPE||!r&&this._orientation&t.macro.ORIENTATION_PORTRAIT?(e.width=i,e.height=n,t.game.container.style["-webkit-transform"]="rotate(0deg)",t.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(e.width=n,e.height=i,t.game.container.style["-webkit-transform"]="rotate(90deg)",t.game.container.style.transform="rotate(90deg)",t.game.container.style["-webkit-transform-origin"]="0px 0px 0px",t.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0,t.game.canvas.style["-webkit-transform"]="translateZ(0px)",t.game.canvas.style.transform="translateZ(0px)"),this._orientationChanging&&setTimeout((function(){t.view._orientationChanging=!1}),1e3)}},{key:"_adjustSizeKeepCanvasSize",value:function(){var e=this._originalDesignResolutionSize.width,t=this._originalDesignResolutionSize.height;e>0&&this.setDesignResolutionSize(e,t,this._resolutionPolicy)}},{key:"_setViewportMeta",value:function(e,t){var i=document.getElementById("cocosMetaElement");i&&t&&document.head.removeChild(i);var n,r,a,s=document.getElementsByName("viewport"),o=s?s[0]:null;for(r in n=o?o.content:"",(i=i||document.createElement("meta")).id="cocosMetaElement",i.name="viewport",i.content="",e)-1===n.indexOf(r)?n+=","+r+"="+e[r]:t&&(a=new RegExp(r+"s*=s*[^,]+"),n.replace(a,r+"="+e[r]));/^,/.test(n)&&(n=n.substr(1)),i.content=n,o&&(o.content=n),document.head.appendChild(i)}},{key:"_adjustViewportMeta",value:function(){!this._isAdjustViewport||d||p||y||(this._setViewportMeta(ie.meta,!1),this._isAdjustViewport=!1)}},{key:"_convertMouseToLocation",value:function(e,t){e.x=this._devicePixelRatio*(e.x-t.left),e.y=this._devicePixelRatio*(t.top+t.height-e.y)}},{key:"_convertTouchWidthScale",value:function(e){var t=this._viewportRect,i=this._scaleX,n=this._scaleY;e._point.x=(e._point.x-t.x)/i,e._point.y=(e._point.y-t.y)/n,e._prevPoint.x=(e._prevPoint.x-t.x)/i,e._prevPoint.y=(e._prevPoint.y-t.y)/n}},{key:"_convertTouchesWithScale",value:function(e){for(var t,i,n=this._viewportRect,r=this._scaleX,a=this._scaleY,s=0;s<e.length;s++){var o=e[s];t=o._point,i=o._prevPoint,t.x=(t.x-n.x)/r,t.y=(t.y-n.y)/a,i.x=(i.x-n.x)/r,i.y=(i.y-n.y)/a}}}]),v}(v));ne.instance=void 0;var re=function(){function e(){a(this,e),this.name="ContainerStrategy"}return n(e,[{key:"preApply",value:function(e){}},{key:"apply",value:function(e,t){}},{key:"postApply",value:function(e){}},{key:"_setupContainer",value:function(e,i,n){var r=t.game.canvas,a=t.game.container;t.sys.os===t.sys.OS_ANDROID&&(document.body.style.width=(e._isRotated?n:i)+"px",document.body.style.height=(e._isRotated?i:n)+"px"),a.style.width=r.style.width=i+"px",a.style.height=r.style.height=n+"px";var s=e._devicePixelRatio=1;e.isRetinaEnabled()&&(s=e._devicePixelRatio=Math.min(e._maxPixelRatio,window.devicePixelRatio||1)),r.width=i*s,r.height=n*s}},{key:"_fixContainer",value:function(){document.body.insertBefore(t.game.container,document.body.firstChild);var e=document.body.style;e.width=window.innerWidth+"px",e.height=window.innerHeight+"px",e.overflow="hidden";var i=t.game.container.style;i.position="fixed",i.left=i.top="0px",document.body.scrollTop=0}}]),e}();re.EQUAL_TO_FRAME=void 0,re.PROPORTION_TO_FRAME=void 0;var ae=function(){function e(){a(this,e),this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}return n(e,[{key:"preApply",value:function(e){}},{key:"apply",value:function(e,t){return{scale:[1,1]}}},{key:"postApply",value:function(e){}},{key:"_buildResult",value:function(e,t,i,n,r,a){Math.abs(e-i)<2&&(i=e),Math.abs(t-n)<2&&(n=t);var s=new h(Math.round((e-i)/2),Math.round((t-n)/2),i,n);return this._result.scale=[r,a],this._result.viewport=s,this._result}}]),e}();ae.EXACT_FIT=void 0,ae.SHOW_ALL=void 0,ae.NO_BORDER=void 0,ae.FIXED_HEIGHT=void 0,ae.FIXED_WIDTH=void 0,function(){var e=function(e){function r(){var e,t;a(this,r);for(var i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(t=s(this,(e=o(r)).call.apply(e,[this].concat(n)))).name="EqualToFrame",t}return i(r,e),n(r,[{key:"apply",value:function(e){var i=e._frameSize.height,n=t.game.container.style;this._setupContainer(e,e._frameSize.width,e._frameSize.height),e._isRotated?n.margin="0 0 0 "+i+"px":n.margin="0px",n.padding="0px"}}]),r}(re),r=function(e){function r(){var e,t;a(this,r);for(var i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(t=s(this,(e=o(r)).call.apply(e,[this].concat(n)))).name="ProportionalToFrame",t}return i(r,e),n(r,[{key:"apply",value:function(e,i){var n,r,a=e._frameSize.width,s=e._frameSize.height,o=t.game.container.style,l=i.width,h=i.height,u=a/l,_=s/h;u<_?(n=a,r=h*u):(n=l*_,r=s);var c=Math.round((a-n)/2),d=Math.round((s-r)/2);n=a-2*c,r=s-2*d,this._setupContainer(e,n,r),e._isRotated?o.margin="0 0 0 "+s+"px":o.margin="0px",o.paddingLeft=c+"px",o.paddingRight=c+"px",o.paddingTop=d+"px",o.paddingBottom=d+"px"}}]),r}(re),l=("undefined"==typeof window?global:window).__globalAdapter;l&&(l.adaptContainerStrategy&&l.adaptContainerStrategy(re.prototype),l.adaptView&&l.adaptView(ne.prototype)),re.EQUAL_TO_FRAME=new e,re.PROPORTION_TO_FRAME=new r;var h=function(e){function r(){var e,t;a(this,r);for(var i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(t=s(this,(e=o(r)).call.apply(e,[this].concat(n)))).name="ExactFit",t}return i(r,e),n(r,[{key:"apply",value:function(e,i){var n=t.game.canvas.width,r=t.game.canvas.height,a=n/i.width,s=r/i.height;return this._buildResult(n,r,n,r,a,s)}}]),r}(ae),u=function(e){function r(){var e,t;a(this,r);for(var i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(t=s(this,(e=o(r)).call.apply(e,[this].concat(n)))).name="ShowAll",t}return i(r,e),n(r,[{key:"apply",value:function(e,i){var n,r,a=t.game.canvas.width,s=t.game.canvas.height,o=i.width,l=i.height,h=a/o,u=s/l,_=0;return h<u?(n=a,r=l*(_=h)):(n=o*(_=u),r=s),this._buildResult(a,s,n,r,_,_)}}]),r}(ae),_=function(e){function r(){var e,t;a(this,r);for(var i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(t=s(this,(e=o(r)).call.apply(e,[this].concat(n)))).name="NoBorder",t}return i(r,e),n(r,[{key:"apply",value:function(e,i){var n,r,a,s=t.game.canvas.width,o=t.game.canvas.height,l=i.width,h=i.height,u=s/l,_=o/h;return u<_?(r=l*(n=_),a=o):(r=s,a=h*(n=u)),this._buildResult(s,o,r,a,n,n)}}]),r}(ae),c=function(e){function r(){var e,t;a(this,r);for(var i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(t=s(this,(e=o(r)).call.apply(e,[this].concat(n)))).name="FixedHeight",t}return i(r,e),n(r,[{key:"apply",value:function(e,i){var n=t.game.canvas.width,r=t.game.canvas.height,a=r/i.height,s=n,o=r;return this._buildResult(n,r,s,o,a,a)}}]),r}(ae),d=function(e){function r(){var e,t;a(this,r);for(var i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(t=s(this,(e=o(r)).call.apply(e,[this].concat(n)))).name="FixedWidth",t}return i(r,e),n(r,[{key:"apply",value:function(e,i){var n=t.game.canvas.width,r=t.game.canvas.height,a=n/i.width,s=n,o=r;return this._buildResult(n,r,s,o,a,a)}}]),r}(ae);ae.EXACT_FIT=new h,ae.SHOW_ALL=new u,ae.NO_BORDER=new _,ae.FIXED_HEIGHT=new c,ae.FIXED_WIDTH=new d}();var se=e("R",function(){function e(t,i){a(this,e),this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(i)}return n(e,[{key:"preApply",value:function(e){this._containerStrategy.preApply(e),this._contentStrategy.preApply(e)}},{key:"apply",value:function(e,t){return this._containerStrategy.apply(e,t),this._contentStrategy.apply(e,t)}},{key:"postApply",value:function(e){this._containerStrategy.postApply(e),this._contentStrategy.postApply(e)}},{key:"setContainerStrategy",value:function(e){e instanceof re&&(this._containerStrategy=e)}},{key:"setContentStrategy",value:function(e){e instanceof ae&&(this._contentStrategy=e)}},{key:"canvasSize",get:function(){return t.v2(t.game.canvas.width,t.game.canvas.height)}}]),e}());se.EXACT_FIT=0,se.NO_BORDER=1,se.SHOW_ALL=2,se.FIXED_HEIGHT=3,se.FIXED_WIDTH=4,se.UNKNOWN=5,se.ContainerStrategy=re,se.ContentStrategy=ae,t.ResolutionPolicy=se;var oe=e("v",ne.instance=t.view=new ne);t.winSize=new r;var le=null,he=null,ue=null,_e=null,ce=e("a",function(e){function r(){return a(this,r),s(this,o(r).call(this))}return i(r,e),n(r,[{key:"setAccelerometerEnabled",value:function(e){e&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){console.log("Device Motion Event request permission: ".concat(e)),P.setAccelerometerEnabled("granted"===e)})):P.setAccelerometerEnabled(e)}},{key:"setAccelerometerInterval",value:function(e){P.setAccelerometerInterval(e)}},{key:"on",value:function(e,i,n,a){return f(o(r.prototype),"on",this).call(this,e,i,n,a),e!==L.KEY_DOWN&&e!==L.KEY_UP||le||(le=N.create({event:N.KEYBOARD,onKeyPressed:function(e,t){t.type=L.KEY_DOWN,de.emit(t.type,t)},onKeyReleased:function(e,t){t.type=L.KEY_UP,de.emit(t.type,t)}}),U.addListener(le,256)),e===L.DEVICEMOTION&&(he||(he=N.create({event:N.ACCELERATION,callback:function(e,i){i.type=L.DEVICEMOTION,t.systemEvent.emit(i.type,i)}}),U.addListener(he,256))),e!==L.TOUCH_START&&e!==L.TOUCH_MOVE&&e!==L.TOUCH_END&&e!==L.TOUCH_CANCEL||ue||(ue=N.create({event:N.TOUCH_ONE_BY_ONE,onTouchBegan:function(e,i){return i.type=L.TOUCH_START,t.systemEvent.emit(i.type,e,i),!0},onTouchMoved:function(e,i){i.type=L.TOUCH_MOVE,t.systemEvent.emit(i.type,e,i)},onTouchEnded:function(e,i){i.type=L.TOUCH_END,t.systemEvent.emit(i.type,e,i)},onTouchCancelled:function(e,i){i.type=L.TOUCH_CANCEL,t.systemEvent.emit(i.type,e,i)}}),U.addListener(ue,256)),e!==L.MOUSE_DOWN&&e!==L.MOUSE_MOVE&&e!==L.MOUSE_UP&&e!==L.MOUSE_WHEEL||_e||(_e=N.create({event:N.MOUSE,onMouseDown:function(e){e.type=L.MOUSE_DOWN,t.systemEvent.emit(e.type,e)},onMouseMove:function(e){e.type=L.MOUSE_MOVE,t.systemEvent.emit(e.type,e)},onMouseUp:function(e){e.type=L.MOUSE_UP,t.systemEvent.emit(e.type,e)},onMouseScroll:function(e){e.type=L.MOUSE_WHEEL,t.systemEvent.emit(e.type,e)}}),U.addListener(_e,256)),i}},{key:"off",value:function(e,t,i){if(f(o(r.prototype),"off",this).call(this,e,t,i),le&&(e===L.KEY_DOWN||e===L.KEY_UP)){var n=this.hasEventListener(L.KEY_DOWN),a=this.hasEventListener(L.KEY_UP);n||a||(U.removeListener(le),le=null)}if(he&&e===L.DEVICEMOTION&&(U.removeListener(he),he=null),ue&&(e===L.TOUCH_START||e===L.TOUCH_MOVE||e===L.TOUCH_END||e===L.TOUCH_CANCEL)){var s=this.hasEventListener(L.TOUCH_START),l=this.hasEventListener(L.TOUCH_MOVE),h=this.hasEventListener(L.TOUCH_END),u=this.hasEventListener(L.TOUCH_CANCEL);s||l||h||u||(U.removeListener(ue),ue=null)}if(_e&&(e===L.MOUSE_DOWN||e===L.MOUSE_MOVE||e===L.MOUSE_UP||e===L.MOUSE_WHEEL)){var _=this.hasEventListener(L.MOUSE_DOWN),c=this.hasEventListener(L.MOUSE_MOVE),d=this.hasEventListener(L.MOUSE_UP),p=this.hasEventListener(L.MOUSE_WHEEL);_||c||d||p||(U.removeListener(_e),_e=null)}}}]),r}(v));ce.EventType=L,t.SystemEvent=ce;var de=e("b",new ce);t.systemEvent=de,g(L,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]);var pe,ye,ve,fe,ge,me,Ee,Se,Re,be,we,Ae,De,Te,Fe,Oe,Ce,xe,Me=e("s",{_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var e,t,i,n,r=this._fnMap;for(e=0,t=r.length;e<t;e++)if((i=r[e])&&void 0!==document[i[1]]){for(e=0,n=i.length;e<n;e++)this._fn[r[0][e]]=i[e];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&(void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement])},requestFullScreen:function(e,t){if(this._supportsFullScreen){if(e=e||document.documentElement,t){var i=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=t,document.addEventListener(i,t,!1)}return e[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(e,i){e=e||document.body;var n=t.game.canvas||e,r=this;this.requestFullScreen(e,i),n.addEventListener(this._touchEvent,(function t(){n.removeEventListener(r._touchEvent,t),r.requestFullScreen(e,i)}))}});Me.init(),t.screen=Me,m(H),function(e){e[e.ADD_COLOR=0]="ADD_COLOR",e[e.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",e[e.GRAYSCALE=2]="GRAYSCALE",e[e.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",e[e.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(xe||(xe=e("I",{})));var ke,ze,Ie,Le,Pe,Ne,Ue,He,Be,We,Ve,Ge,Ye,Xe,je,qe,Ke,Ze,Qe,Je,$e,et,tt,it,nt,rt,at,st,ot,lt,ht,ut,_t,ct,dt,pt,yt,vt,ft,gt,mt,Et,St,Rt={parent:null,owner:null,subModelIdx:0},bt=e("U",(pe=E("cc.UIRenderable"),ye=W(V),ve=S(H),fe=w(),ge=A(),me=S(H),Ee=w(),Se=A(),Re=w(),be=A(),pe(we=ye(we=B(we=R((Ce=Oe=function(e){function t(){var e,i;a(this,t);for(var n=arguments.length,r=new Array(n),h=0;h<n;h++)r[h]=arguments[h];return(i=s(this,(e=o(t)).call.apply(e,[this].concat(r))))._uiMaterial=null,i._uiMaterialIns=null,i._uiMaterialDirty=!1,i._uiMatInsDirty=!1,D(i,"_srcBlendFactor",De,l(i)),D(i,"_dstBlendFactor",Te,l(i)),D(i,"_color",Fe,l(i)),i._assembler=null,i._postAssembler=null,i._renderData=null,i._renderDataFlag=!0,i._renderFlag=!0,i._delegateSrc=null,i._instanceMaterialType=xe.ADD_COLOR_AND_TEXTURE,i._blendTemplate={blendState:{targets:[{blendSrc:H.SRC_ALPHA,blendDst:H.ONE_MINUS_SRC_ALPHA}]}},i._lastParent=null,i}return i(t,e),n(t,[{key:"getUIRenderMaterial",value:function(){return this._uiMaterialIns||this._uiMaterial}},{key:"getUIMaterialInstance",value:function(){return this._uiMaterialIns&&!this._uiMatInsDirty||(Rt.owner=this,Rt.parent=this._uiMaterial,this._uiMaterialIns=new G(Rt),this._uiMatInsDirty=!1),this._uiMaterialIns}},{key:"__preload",value:function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()}},{key:"onEnable",value:function(){this.node.on(L.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(L.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=this._canRender()}},{key:"onDisable",value:function(){this.node.off(L.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(L.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=!1}},{key:"onDestroy",value:function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var e=0;e<this._materialInstances.length;e++)this._materialInstances[e].destroy();this._uiMaterialIns&&this._uiMaterialIns.destroy(),this._renderData=null}},{key:"markForUpdateRenderData",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._renderFlag=this._canRender(),e&&this._renderFlag){var t=this._renderData;t&&(t.vertDirty=!0),this._renderDataFlag=e}else e||(this._renderDataFlag=e)}},{key:"requestRenderData",value:function(){var e=Y.add();return this._renderData=e,e}},{key:"destroyRenderData",value:function(){this._renderData&&(Y.remove(this._renderData),this._renderData=null)}},{key:"updateAssembler",value:function(e){this._renderFlag&&(this._checkAndUpdateRenderData(),this._render(e))}},{key:"postUpdateAssembler",value:function(e){this._renderFlag&&this._postRender(e)}},{key:"_render",value:function(e){}},{key:"_postRender",value:function(e){}},{key:"_checkAndUpdateRenderData",value:function(){this._renderDataFlag&&(this._assembler.updateRenderData(this),this._renderDataFlag=!1)}},{key:"_canRender",value:function(){return this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)}},{key:"_postCanRender",value:function(){}},{key:"_updateColor",value:function(){this._assembler&&this._assembler.updateColor&&this._assembler.updateColor(this)}},{key:"_updateBlendFunc",value:function(){var e=this.getMaterial(0),t=this._blendTemplate.blendState.targets[0];return e?(t.blendDst===this._dstBlendFactor&&t.blendSrc===this._srcBlendFactor||(e=this.material,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor,e.overridePipelineStates(this._blendTemplate,0)),e):((null!==this._uiMaterialIns&&this._uiMatInsDirty||t.blendDst!==this._dstBlendFactor||t.blendSrc!==this._srcBlendFactor)&&(e=this.getUIMaterialInstance(),t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor,e.overridePipelineStates(this._blendTemplate,0)),e||this.getUIRenderMaterial())}},{key:"_nodeStateChange",value:function(e){this._renderData&&this.markForUpdateRenderData();for(var i,n=T(this.node.children);!(i=n()).done;){var r=i.value.getComponent(t);r&&r.markForUpdateRenderData()}}},{key:"_updateBuiltinMaterial",value:function(){var e=!1;if(this._uiMaterial||(e=!0),this._uiMaterial&&!this._uiMaterialDirty)return this._uiMaterial;switch(this._instanceMaterialType){case xe.ADD_COLOR:this._uiMaterial=X.get("ui-base-material");break;case xe.ADD_COLOR_AND_TEXTURE:this._uiMaterial=X.get("ui-sprite-material");break;case xe.GRAYSCALE:this._uiMaterial=X.get("ui-sprite-gray-material");break;case xe.USE_ALPHA_SEPARATED:this._uiMaterial=X.get("ui-sprite-alpha-sep-material");break;case xe.USE_ALPHA_SEPARATED_AND_GRAY:this._uiMaterial=X.get("ui-sprite-gray-alpha-sep-material");break;default:this._uiMaterial=X.get("ui-sprite-material")}return this._uiMaterialDirty=!1,e||(this._uiMatInsDirty=!0),this._uiMaterial}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(e){this._srcBlendFactor!==e&&(this._srcBlendFactor=e,this._updateBlendFunc())}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(e){this._dstBlendFactor!==e&&(this._dstBlendFactor=e,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(e){this._color.equals(e)||(this._color.set(e),this._updateColor(),this.markForUpdateRenderData())}},{key:"uiMaterial",get:function(){return this._uiMaterial},set:function(e){this._uiMaterial=e}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(e){this._delegateSrc=e}}]),t}(j),Oe.BlendState=H,Oe.Assembler=null,Oe.PostAssembler=null,b((Ae=Ce).prototype,"srcBlendFactor",[ve,fe,ge],Object.getOwnPropertyDescriptor(Ae.prototype,"srcBlendFactor"),Ae.prototype),b(Ae.prototype,"dstBlendFactor",[me,Ee,Se],Object.getOwnPropertyDescriptor(Ae.prototype,"dstBlendFactor"),Ae.prototype),b(Ae.prototype,"color",[Re,be],Object.getOwnPropertyDescriptor(Ae.prototype,"color"),Ae.prototype),De=b(Ae.prototype,"_srcBlendFactor",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H.SRC_ALPHA}}),Te=b(Ae.prototype,"_dstBlendFactor",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H.ONE_MINUS_SRC_ALPHA}}),Fe=b(Ae.prototype,"_color",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return O.WHITE.clone()}}),we=Ae))||we)||we)||we)||we));!function(e){e[e.SIMPLE=0]="SIMPLE",e[e.SLICED=1]="SLICED",e[e.TILED=2]="TILED",e[e.FILLED=3]="FILLED"}(gt||(gt={})),m(gt),function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL",e[e.RADIAL=2]="RADIAL"}(mt||(mt={})),m(mt),function(e){e[e.CUSTOM=0]="CUSTOM",e[e.TRIMMED=1]="TRIMMED",e[e.RAW=2]="RAW"}(Et||(Et={})),m(Et),function(e){e.SPRITE_FRAME_CHANGED="spriteframe-changed"}(St||(St={}));var wt,At,Dt,Tt,Ft,Ot,Ct,xt,Mt,kt=e("d",(ke=E("cc.Sprite"),ze=x(),Ie=Z(110),Le=M(),Pe=S(q),Ne=w(),Ue=A(),He=S(K),Be=w(),We=A(),Ve=S(gt),Ge=w(),Ye=A(),Xe=S(mt),je=A(),qe=A(),Ke=k(),Ze=A(),Qe=k(),Je=A(),$e=w(),et=A(),tt=S(Et),it=w(),nt=A(),ke(rt=ze(rt=Ie(rt=Le((ft=vt=function(e){function r(){var e,t;a(this,r);for(var i=arguments.length,n=new Array(i),h=0;h<i;h++)n[h]=arguments[h];return t=s(this,(e=o(r)).call.apply(e,[this].concat(n))),D(t,"_spriteFrame",st,l(t)),D(t,"_type",ot,l(t)),D(t,"_fillType",lt,l(t)),D(t,"_sizeMode",ht,l(t)),D(t,"_fillCenter",ut,l(t)),D(t,"_fillStart",_t,l(t)),D(t,"_fillRange",ct,l(t)),D(t,"_isTrimmedMode",dt,l(t)),D(t,"_useGrayscale",pt,l(t)),D(t,"_atlas",yt,l(t)),t}return i(r,e),n(r,[{key:"__preload",value:function(){this.changeMaterialForDefine(),f(o(r.prototype),"__preload",this).call(this),this._spriteFrame&&(this._spriteFrame.on("load",this._markForUpdateUvDirty,this),this._markForUpdateUvDirty())}},{key:"onEnable",value:function(){f(o(r.prototype),"onEnable",this).call(this),this._activateMaterial(),this.getMaterial(0)&&this._updateBlendFunc()}},{key:"onDestroy",value:function(){f(o(r.prototype),"onDestroy",this).call(this),this.destroyRenderData(),this._spriteFrame&&this._spriteFrame.off("load")}},{key:"changeSpriteFrameFromAtlas",value:function(e){if(this._atlas){var t=this._atlas.getSpriteFrame(e);this.spriteFrame=t}else console.warn("SpriteAtlas is null.")}},{key:"changeMaterialForDefine",value:function(){var e;this._spriteFrame&&(e=this._spriteFrame.texture);var t=!1;if(e instanceof Q){var i=e.getPixelFormat();t=i===J.RGBA_ETC1||i===J.RGB_A_PVRTC_4BPPV1||i===J.RGB_A_PVRTC_2BPPV1}t&&this.grayscale?this._instanceMaterialType=xe.USE_ALPHA_SEPARATED_AND_GRAY:t?this._instanceMaterialType=xe.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=xe.GRAYSCALE:this._instanceMaterialType=xe.ADD_COLOR_AND_TEXTURE,this._uiMaterialDirty=!0}},{key:"_render",value:function(e){e.commitComp(this,this._spriteFrame.getGFXTexture(),this._assembler,this._spriteFrame.texture.getGFXSampler())}},{key:"_canRender",value:function(){if(!f(o(r.prototype),"_canRender",this).call(this))return!1;var e=this._spriteFrame;return!(!e||!e.textureLoaded())}},{key:"_flushAssembler",value:function(){var e=r.Assembler.getAssembler(this);this._assembler!==e&&(this.destroyRenderData(),this._assembler=e),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this._updateColor())}},{key:"_applySpriteSize",value:function(){if(this._spriteFrame){if(Et.RAW===this._sizeMode){var e=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(e)}else if(Et.TRIMMED===this._sizeMode){var t=this._spriteFrame.getRect();this.node._uiProps.uiTransformComp.setContentSize(t.width,t.height)}this._activateMaterial()}}},{key:"_resized",value:function(){}},{key:"_activateMaterial",value:function(){var e=this._spriteFrame,i=this.getRenderMaterial(0);t.game.renderType!==t.game.RENDER_TYPE_CANVAS?(e&&i&&this.markForUpdateRenderData(),this._renderData&&(this._renderData.material=i)):this.markForUpdateRenderData()}},{key:"_onTextureLoaded",value:function(){this.isValid&&(this.changeMaterialForDefine(),this._applySpriteSize())}},{key:"_applySpriteFrame",value:function(e){var t=this._spriteFrame;this._renderData&&(e&&e.off("load",this._markForUpdateUvDirty),t&&t.on("load",this._markForUpdateUvDirty,this),this._renderData.uvDirty||(this._renderData.uvDirty=!e||!t||e.uvHash!==t.uvHash),this._renderDataFlag=this._renderData.uvDirty),t&&(e&&t===e||(t.loaded?this._onTextureLoaded():t.once("load",this._onTextureLoaded,this)))}},{key:"_markForUpdateUvDirty",value:function(){this._renderData&&(this._renderData.uvDirty=!0,this._renderDataFlag=!0)}},{key:"spriteAtlas",get:function(){return this._atlas},set:function(e){this._atlas!==e&&(this._atlas=e)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(e){if(this._spriteFrame!==e){var t=this._spriteFrame;this._spriteFrame=e,this.markForUpdateRenderData(!1),this._applySpriteFrame(t)}}},{key:"type",get:function(){return this._type},set:function(e){this._type!==e&&(this._type=e,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(e){this._fillType!==e&&(e===mt.RADIAL||this._fillType===mt.RADIAL?(this.destroyRenderData(),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0)),this._fillType=e,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(e){this._fillCenter.x=e.x,this._fillCenter.y=e.y,this._type===gt.FILLED&&this._renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(e){this._fillStart=z(e,-1,1),this._type===gt.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"fillRange",get:function(){return this._fillRange},set:function(e){this._fillRange=z(e,-1,1),this._type===gt.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(e){this._isTrimmedMode!==e&&(this._isTrimmedMode=e,this._type===gt.SIMPLE&&this._renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(e){this._useGrayscale!==e&&(this._useGrayscale=e,this._instanceMaterialType=!0===e?xe.GRAYSCALE:xe.ADD_COLOR_AND_TEXTURE,this._uiMaterialDirty=!0)}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(e){this._sizeMode!==e&&(this._sizeMode=e,e!==Et.CUSTOM&&this._applySpriteSize())}}]),r}(bt),vt.FillType=mt,vt.Type=gt,vt.SizeMode=Et,vt.EventType=St,b((at=ft).prototype,"spriteAtlas",[Pe,Ne,Ue],Object.getOwnPropertyDescriptor(at.prototype,"spriteAtlas"),at.prototype),b(at.prototype,"spriteFrame",[He,Be,We],Object.getOwnPropertyDescriptor(at.prototype,"spriteFrame"),at.prototype),b(at.prototype,"type",[Ve,Ge,Ye],Object.getOwnPropertyDescriptor(at.prototype,"type"),at.prototype),b(at.prototype,"fillType",[Xe,je],Object.getOwnPropertyDescriptor(at.prototype,"fillType"),at.prototype),b(at.prototype,"fillCenter",[qe],Object.getOwnPropertyDescriptor(at.prototype,"fillCenter"),at.prototype),b(at.prototype,"fillStart",[Ke,Ze],Object.getOwnPropertyDescriptor(at.prototype,"fillStart"),at.prototype),b(at.prototype,"fillRange",[Qe,Je],Object.getOwnPropertyDescriptor(at.prototype,"fillRange"),at.prototype),b(at.prototype,"trim",[$e,et],Object.getOwnPropertyDescriptor(at.prototype,"trim"),at.prototype),b(at.prototype,"grayscale",[C],Object.getOwnPropertyDescriptor(at.prototype,"grayscale"),at.prototype),b(at.prototype,"sizeMode",[tt,it,nt],Object.getOwnPropertyDescriptor(at.prototype,"sizeMode"),at.prototype),st=b(at.prototype,"_spriteFrame",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=b(at.prototype,"_type",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gt.SIMPLE}}),lt=b(at.prototype,"_fillType",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mt.HORIZONTAL}}),ht=b(at.prototype,"_sizeMode",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Et.TRIMMED}}),ut=b(at.prototype,"_fillCenter",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u(0,0)}}),_t=b(at.prototype,"_fillStart",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ct=b(at.prototype,"_fillRange",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dt=b(at.prototype,"_isTrimmedMode",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),pt=b(at.prototype,"_useGrayscale",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yt=b(at.prototype,"_atlas",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=at))||rt)||rt)||rt)||rt)),zt=e("S",(wt=E("cc.SubContextView"),At=x(),Dt=Z(110),Tt=W(V),Ft=M(),Ot=A(),wt(Ct=At(Ct=Dt(Ct=Tt(Ct=Ft((b((xt=function(e){function t(){var e;return a(this,t),e=s(this,o(t).call(this)),D(e,"_fps",Mt,l(e)),e._sprite=void 0,e._imageAsset=void 0,e._context=void 0,e._updatedTime=0,e._updateInterval=0,e._firstlyEnabled=!0,e._sprite=null,e._imageAsset=new $,e._context=null,e._updatedTime=performance.now(),e}return i(t,e),n(t,[{key:"fps",get:function(){return this._fps},set:function(e){this._fps!==e&&(this._fps=e,this._updateInterval=1/e,this._updateSubContextFrameRate())}}]),n(t,[{key:"onLoad",value:function(){if(window.__globalAdapter&&__globalAdapter.getOpenDataContext){this._updateInterval=1e3/this._fps,this._context=__globalAdapter.getOpenDataContext(),this.reset();var e=this._imageAsset,t=this._context.canvas;if(e.reset(t),e._texture.create(t.width,t.height),this._sprite=this.node.getComponent(kt),this._sprite||(this._sprite=this.node.addComponent(kt)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._imageAsset._texture;else{var i=new K;i.texture=this._imageAsset._texture,this._sprite.spriteFrame=i}}else this.enabled=!1}},{key:"onEnable",value:function(){this._firstlyEnabled&&this._context?(this._context.postMessage({fromEngine:!0,event:"boot"}),this._firstlyEnabled=!1):this._runSubContextMainLoop(),this._registerNodeEvent(),this._updateSubContextFrameRate(),this.updateSubContextViewport()}},{key:"onDisable",value:function(){this._unregisterNodeEvent(),this._stopSubContextMainLoop()}},{key:"update",value:function(e){if(void 0===e)return this._context&&this._context.postMessage({fromEngine:!0,event:"step"}),void this._updateSubContextTexture();performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())}},{key:"reset",value:function(){if(this._context){this.updateSubContextViewport();var e=this._context.canvas,t=this.node.getComponent(V);e&&(e.width=t.width,e.height=t.height)}}},{key:"updateSubContextViewport",value:function(){if(this._context){var e=this.node.getComponent(V).getBoundingBoxToWorld(),t=oe.getScaleX(),i=oe.getScaleY(),n=oe.getViewportRect();this._context.postMessage({fromEngine:!0,event:"viewport",x:e.x*t+n.x,y:e.y*i+n.y,width:e.width*t,height:e.height*i})}}},{key:"_updateSubContextTexture",value:function(){var e=this._imageAsset;if(e&&this._context&&!(e.width<=0||e.height<=0)){var t=this._context.canvas;e.reset(t),(t.width>e.width||t.height>e.height)&&this._imageAsset._texture.create(t.width,t.height),this._imageAsset._texture.uploadData(t)}}},{key:"_registerNodeEvent",value:function(){this.node.on(ee.EventType.TRANSFORM_CHANGED,this.updateSubContextViewport,this),this.node.on(ee.EventType.SIZE_CHANGED,this.updateSubContextViewport,this)}},{key:"_unregisterNodeEvent",value:function(){this.node.off(ee.EventType.TRANSFORM_CHANGED,this.updateSubContextViewport,this),this.node.off(ee.EventType.SIZE_CHANGED,this.updateSubContextViewport,this)}},{key:"_runSubContextMainLoop",value:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!0})}},{key:"_stopSubContextMainLoop",value:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!1})}},{key:"_updateSubContextFrameRate",value:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"frameRate",value:this._fps})}}]),t}(I)).prototype,"fps",[Ot],Object.getOwnPropertyDescriptor(xt.prototype,"fps"),xt.prototype),Mt=b(xt.prototype,"_fps",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),Ct=xt))||Ct)||Ct)||Ct)||Ct)||Ct));t.SubContextView=zt}}}));
