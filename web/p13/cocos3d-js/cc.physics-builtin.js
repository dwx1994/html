System.register(["./deprecated-fd5a8e75.js","./deprecated-9a4df5e2.js","./index-597c71d0.js","./SubContextView-ee466772.js","./component-event-handler-ff37202d.js","./index-b1fc77a7.js","./terrain-asset-cc69bca3.js","./array-collision-matrix-7cbcfe04.js","./util-e799034d.js"],(function(){"use strict";var e,i,t,o,s,r,n,l,a,d,h,u,c,y,f,p,v,k,g;return{setters:[function(h){e=h.j,i=h.d,t=h.M,o=h.V,s=h.Q,r=h.b,n=h.e,l=h.f,a=h.aO,d=h.ap},function(e){h=e.dw,u=e.dD,c=e.dB},function(e){y=e.Q},function(){},function(){},function(e){f=e.P,p=e.a,v=e.s},function(){},function(e){k=e.A},function(e){g=e.m}],execute:function(){var _=function(){function t(){i(this,t),this.collisionFilterGroup=f.PhysicsGroup.DEFAULT,this.collisionFilterMask=-1}return e(t,[{key:"getGroup",value:function(){return this.collisionFilterGroup}},{key:"setGroup",value:function(e){this.collisionFilterGroup=e}},{key:"addGroup",value:function(e){this.collisionFilterGroup|=e}},{key:"removeGroup",value:function(e){this.collisionFilterGroup&=~e}},{key:"getMask",value:function(){return this.collisionFilterMask}},{key:"setMask",value:function(e){this.collisionFilterMask=e}},{key:"addMask",value:function(e){this.collisionFilterMask|=e}},{key:"removeMask",value:function(e){this.collisionFilterMask&=~e}}]),t}(),B=new t,w=new o,S=new o,M=new s,m=function(t){function o(e,t){var s;return i(this,o),(s=n(this,l(o).call(this)))._id=void 0,s.index=-1,s.ref=0,s.node=void 0,s.world=void 0,s.shapes=[],s.wrappedBody=null,s._id=o.idCounter++,s.node=e,s.world=t,s}return r(o,t),e(o,[{key:"id",get:function(){return this._id}},{key:"enabled",set:function(e){e?this.index<0&&(this.index=this.world.bodies.length,this.world.addSharedBody(this),this.syncInitial()):this.index>=0&&0==this.shapes.length&&(this.index=-1,this.world.removeSharedBody(this))}},{key:"reference",set:function(e){e?this.ref++:this.ref--,0==this.ref&&this.destroy()}}],[{key:"getSharedBody",value:function(e,i){var t=e.uuid;if(o.sharedBodesMap.has(t))return o.sharedBodesMap.get(t);var s=new o(e,i);return o.sharedBodesMap.set(e.uuid,s),s}}]),e(o,[{key:"intersects",value:function(e){for(var i=0;i<this.shapes.length;i++)for(var t=this.shapes[i],o=0;o<e.shapes.length;o++){var s=e.shapes[o];(t.collider.needTriggerEvent||s.collider.needTriggerEvent)&&h.resolve(t.worldShape,s.worldShape)&&(this.world.shapeArr.push(t),this.world.shapeArr.push(s))}}},{key:"addShape",value:function(e){this.shapes.indexOf(e)<0&&this.shapes.push(e)}},{key:"removeShape",value:function(e){var i=this.shapes.indexOf(e);i>=0&&this.shapes.splice(i,1)}},{key:"syncSceneToPhysics",value:function(){if(this.node.hasChangedFlags){this.node.getWorldMatrix(B),w.set(this.node.worldPosition),M.set(this.node.worldRotation),S.set(this.node.worldScale);for(var e=0;e<this.shapes.length;e++)this.shapes[e].transform(B,w,M,S)}}},{key:"syncInitial",value:function(){this.node.getWorldMatrix(B),w.set(this.node.worldPosition),M.set(this.node.worldRotation),S.set(this.node.worldScale);for(var e=0;e<this.shapes.length;e++)this.shapes[e].transform(B,w,M,S)}},{key:"destroy",value:function(){o.sharedBodesMap.delete(this.node.uuid),this.node=null,this.world=null,this.shapes=null}}]),o}(_);m.sharedBodesMap=new Map,m.idCounter=0;var x=new o,b={type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:{}},C=function(){function t(){i(this,t),this.shapeArr=[],this.bodies=[],this._shapeArrPrev=[],this._collisionMatrix=new k,this._collisionMatrixPrev=new k}return e(t,[{key:"setGravity",value:function(e){}},{key:"setAllowSleep",value:function(e){}},{key:"setDefaultMaterial",value:function(e){}},{key:"step",value:function(e){var i=this._shapeArrPrev;this._shapeArrPrev=this.shapeArr,this.shapeArr=i,this.shapeArr.length=0;for(var t=0;t<this.bodies.length;t++)for(var o=this.bodies[t],s=t+1;s<this.bodies.length;s++){var r=this.bodies[s];0!=(o.collisionFilterGroup&r.collisionFilterMask)&&0!=(r.collisionFilterGroup&o.collisionFilterMask)&&o.intersects(r)}}},{key:"syncSceneToPhysics",value:function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].syncSceneToPhysics()}},{key:"emitEvents",value:function(){this.emitTriggerEvent()}},{key:"raycastClosest",value:function(e,i,t){for(var s=1/0,r=i.maxDistance,n=i.mask,l=0;l<this.bodies.length;l++){var a=this.bodies[l];if(a.collisionFilterGroup&n)for(var d=0;d<a.shapes.length;d++){var u=a.shapes[d],c=h.resolve(e,u.worldShape);0==c||c>r||s>c&&(s=c,o.normalize(x,e.d),o.scaleAndAdd(x,e.o,x,c),t._assign(x,c,u.collider,o.ZERO))}}return!(s==1/0)}},{key:"raycast",value:function(e,i,t,s){for(var r=i.maxDistance,n=i.mask,l=0;l<this.bodies.length;l++){var a=this.bodies[l];if(a.collisionFilterGroup&n)for(var d=0;d<a.shapes.length;d++){var u=a.shapes[d],c=h.resolve(e,u.worldShape);if(!(0==c||c>r)){var y=t.add();e.computeHit(x,c),y._assign(x,c,u.collider,o.ZERO),s.push(y)}}}return s.length>0}},{key:"getSharedBody",value:function(e){return m.getSharedBody(e,this)}},{key:"addSharedBody",value:function(e){this.bodies.indexOf(e)<0&&this.bodies.push(e)}},{key:"removeSharedBody",value:function(e){var i=this.bodies.indexOf(e);i>=0&&this.bodies.splice(i,1)}},{key:"updateCollisionMatrix",value:function(e,i){for(var t=0;t<this.bodies.length;t++){var o=this.bodies[t];o.collisionFilterGroup==e&&(o.collisionFilterMask=i)}}},{key:"emitTriggerEvent",value:function(){for(var e,i,t=0;t<this.shapeArr.length;t+=2)e=this.shapeArr[t],i=this.shapeArr[t+1],b.selfCollider=e.collider,b.otherCollider=i.collider,this._collisionMatrix.set(e.id,i.id,!0),this._collisionMatrixPrev.get(e.id,i.id)?b.type="onTriggerStay":b.type="onTriggerEnter",e.collider&&e.collider.emit(b.type,b),b.selfCollider=i.collider,b.otherCollider=e.collider,i.collider&&i.collider.emit(b.type,b);for(var o=0;o<this._shapeArrPrev.length;o+=2)e=this._shapeArrPrev[o],i=this._shapeArrPrev[o+1],this._collisionMatrixPrev.get(e.id,i.id)&&(this._collisionMatrix.get(e.id,i.id)||(b.type="onTriggerExit",b.selfCollider=e.collider,b.otherCollider=i.collider,e.collider&&e.collider.emit(b.type,b),b.selfCollider=i.collider,b.otherCollider=e.collider,i.collider&&i.collider.emit(b.type,b),this._collisionMatrix.set(e.id,i.id,!1)));var s=this._collisionMatrixPrev.matrix;this._collisionMatrixPrev.matrix=this._collisionMatrix.matrix,this._collisionMatrix.matrix=s,this._collisionMatrix.reset()}},{key:"impl",get:function(){return this}}]),t}(),G=function(){function t(){i(this,t)}return e(t,[{key:"initialize",value:function(e){this._rigidBody=e,this._sharedBody=f.instance.physicsWorld.getSharedBody(this._rigidBody.node),this._sharedBody.reference=!0,this._sharedBody.wrappedBody=this}},{key:"onEnable",value:function(){this._sharedBody.setGroup(this._rigidBody.group),f.instance.useCollisionMatrix&&this._sharedBody.setMask(f.instance.collisionMatrix[this._rigidBody.group]),this._sharedBody.enabled=!0}},{key:"onDisable",value:function(){this._sharedBody.enabled=!1}},{key:"onDestroy",value:function(){this._sharedBody.reference=!1,this._rigidBody=null,this._sharedBody=null}},{key:"setMass",value:function(e){}},{key:"setLinearDamping",value:function(e){}},{key:"setAngularDamping",value:function(e){}},{key:"setIsKinematic",value:function(e){}},{key:"useGravity",value:function(e){}},{key:"fixRotation",value:function(e){}},{key:"setLinearFactor",value:function(e){}},{key:"setAngularFactor",value:function(e){}},{key:"setAllowSleep",value:function(e){}},{key:"wakeUp",value:function(){}},{key:"sleep",value:function(){}},{key:"clearState",value:function(){}},{key:"clearForces",value:function(){}},{key:"clearVelocity",value:function(){}},{key:"setSleepThreshold",value:function(e){}},{key:"getSleepThreshold",value:function(){return 0}},{key:"getLinearVelocity",value:function(e){}},{key:"setLinearVelocity",value:function(e){}},{key:"getAngularVelocity",value:function(e){}},{key:"setAngularVelocity",value:function(e){}},{key:"applyForce",value:function(e,i){}},{key:"applyLocalForce",value:function(e,i){}},{key:"applyImpulse",value:function(e,i){}},{key:"applyLocalImpulse",value:function(e,i){}},{key:"applyTorque",value:function(e){}},{key:"applyLocalTorque",value:function(e){}},{key:"setGroup",value:function(e){this._sharedBody.setGroup(e)}},{key:"getGroup",value:function(){return this._sharedBody.getGroup()}},{key:"addGroup",value:function(e){this._sharedBody.addGroup(e)}},{key:"removeGroup",value:function(e){this._sharedBody.removeGroup(e)}},{key:"setMask",value:function(e){this._sharedBody.setMask(e)}},{key:"getMask",value:function(){return this._sharedBody.getMask()}},{key:"addMask",value:function(e){this._sharedBody.addMask(e)}},{key:"removeMask",value:function(e){this._sharedBody.removeMask(e)}},{key:"impl",get:function(){return this}},{key:"isAwake",get:function(){return!0}},{key:"isSleepy",get:function(){return!1}},{key:"isSleeping",get:function(){return!1}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"sharedBody",get:function(){return this._sharedBody}}]),t}(),A=function(){function t(){i(this,t),this.id=t.idCounter++}return e(t,[{key:"getAABB",value:function(e){}},{key:"getBoundingSphere",value:function(e){}},{key:"setMaterial",value:function(e){}},{key:"setAsTrigger",value:function(e){}},{key:"setCenter",value:function(e){o.copy(this._localShape.center,e)}},{key:"initialize",value:function(e){this._collider=e,this._sharedBody=f.instance.physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0}},{key:"onLoad",value:function(){this.setCenter(this._collider.center)}},{key:"onEnable",value:function(){this._sharedBody.addShape(this),this._sharedBody.enabled=!0}},{key:"onDisable",value:function(){this._sharedBody.removeShape(this),this._sharedBody.enabled=!1}},{key:"onDestroy",value:function(){this._sharedBody.reference=!1,this._collider=null,this._localShape=null,this._worldShape=null}},{key:"transform",value:function(e,i,t,o){this._localShape.transform(e,i,t,o,this._worldShape)}},{key:"getGroup",value:function(){return this._sharedBody.getGroup()}},{key:"setGroup",value:function(e){this._sharedBody.setGroup(e)}},{key:"addGroup",value:function(e){this._sharedBody.addGroup(e)}},{key:"removeGroup",value:function(e){this._sharedBody.removeGroup(e)}},{key:"getMask",value:function(){return this._sharedBody.getMask()}},{key:"setMask",value:function(e){this._sharedBody.setMask(e)}},{key:"addMask",value:function(e){this._sharedBody.addMask(e)}},{key:"removeMask",value:function(e){this._sharedBody.removeMask(e)}},{key:"attachedRigidBody",get:function(){return null}},{key:"localShape",get:function(){return this._localShape}},{key:"worldShape",get:function(){return this._worldShape}},{key:"impl",get:function(){return this._worldShape}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"collider",get:function(){return this._collider}}]),t}();A.idCounter=0;var F=function(t){function s(){var e;return i(this,s),(e=n(this,l(s).call(this)))._localShape=new u,e._worldShape=new u,e}return r(s,t),e(s,[{key:"localObb",get:function(){return this._localShape}},{key:"worldObb",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),e(s,[{key:"setSize",value:function(e){o.multiplyScalar(this.localObb.halfExtents,e,.5),o.multiply(this.worldObb.halfExtents,this.localObb.halfExtents,this.collider.node.worldScale)}},{key:"onLoad",value:function(){a(l(s.prototype),"onLoad",this).call(this),this.setSize(this.collider.size)}}]),s}(A),P=function(t){function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return i(this,o),(e=n(this,l(o).call(this)))._localShape=new c(0,0,0,t),e._worldShape=new c(0,0,0,t),e}return r(o,t),e(o,[{key:"setRadius",value:function(e){this.localSphere.radius=e;var i=g(this.collider.node.worldScale);this.worldSphere.radius=this.localSphere.radius*i}},{key:"localSphere",get:function(){return this._localShape}},{key:"worldSphere",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),e(o,[{key:"onLoad",value:function(){a(l(o.prototype),"onLoad",this).call(this),this.setRadius(this.collider.radius)}}]),o}(A),T=function(t){function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.Y_AXIS;i(this,o);var a=(s-2*t)/2,d=a<0?0:a;return(e=n(this,l(o).call(this)))._localShape=new y(t,d,r),e._worldShape=new y(t,d,r),e}return r(o,t),e(o,[{key:"localCapsule",get:function(){return this._localShape}},{key:"worldCapsule",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),e(o,[{key:"setRadius",value:function(e){this.localCapsule.radius=e,this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)}},{key:"setCylinderHeight",value:function(e){this.localCapsule.halfHeight=e/2,this.localCapsule.updateCache(),this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)}},{key:"setDirection",value:function(e){this.localCapsule.axis=e,this.localCapsule.updateCache(),this.worldCapsule.axis=e,this.worldCapsule.updateCache(),this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)}},{key:"onLoad",value:function(){a(l(o.prototype),"onLoad",this).call(this),this.setRadius(this.collider.radius),this.setDirection(this.collider.direction)}}]),o}(A);d(T.prototype,"shape.prototype",[{name:"setHeight",suggest:"You should use the interface provided by the component."}]),v("builtin",{RigidBody:G,BoxShape:F,SphereShape:P,PhysicsWorld:C,CapsuleShape:T})}}}));
